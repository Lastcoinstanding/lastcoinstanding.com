<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What Bitcoin Is | Last Coin Standing</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0908;
            --bg-panel: #141210;
            --border: #2a2520;
            --orange: #F7931A;
            --grey-circle: #3a3530;
            --grey-hover: #5a5550;
            --text: #d8d2ca;
            --text-dim: #908880;
            --text-bright: #f2eee8;
            --font: 'Outfit', sans-serif;
        }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: var(--font); min-height: 100vh; overflow-x: hidden; -webkit-font-smoothing: antialiased; }
        .page { max-width: 1140px; margin: 0 auto; padding: 48px 24px 60px; }
        header { text-align: center; margin-bottom: 48px; }
        header h1 { font-size: clamp(1.8rem, 4vw, 2.8rem); font-weight: 800; color: var(--orange); letter-spacing: -0.02em; margin-bottom: 10px; }
        header .subtitle { font-size: clamp(0.9rem, 1.8vw, 1.05rem); color: var(--text-dim); font-weight: 400; letter-spacing: 0.01em; }
        main { display: grid; grid-template-columns: 1fr 360px; gap: 48px; align-items: start; }
        .viz-section { display: flex; flex-direction: column; align-items: center; }
        .svg-wrap { width: 100%; max-width: 560px; position: relative; }
        .svg-wrap::before { content: ''; position: absolute; top: 50%; left: 50%; width: 70%; height: 70%; transform: translate(-50%, -50%); background: radial-gradient(circle, rgba(247,147,26,0.025) 0%, transparent 70%); pointer-events: none; transition: opacity 1.5s ease; }
        .svg-wrap.has-explored::before { opacity: 1.6; }
        #flower { width: 100%; height: auto; display: block; }
        .flower-circle { fill: none; stroke: var(--grey-circle); stroke-width: 1.8; transition: stroke 0.6s ease, stroke-opacity 0.6s ease, fill 0.6s ease; opacity: 0; }
        .flower-circle.visible { opacity: 1; filter: drop-shadow(0 0 3px rgba(255,255,255,0.04)); }
        .flower-circle.hover { stroke: var(--grey-hover); filter: drop-shadow(0 0 6px rgba(255,255,255,0.08)); }
        .flower-circle.explored { stroke: var(--orange); stroke-opacity: 0.7; fill: rgba(247, 147, 26, 0.04); }
        .flower-circle.active { stroke: var(--orange); stroke-opacity: 1; fill: rgba(247, 147, 26, 0.06); filter: url(#glow); }
        .hit-area { fill: transparent; stroke: none; cursor: pointer; }
        .float-label { transition: opacity 0.25s ease; pointer-events: none; }
        .label-text { fill: var(--text-bright); font-size: 15px; font-weight: 700; text-anchor: middle; dominant-baseline: central; paint-order: stroke; stroke: var(--bg); stroke-width: 4px; stroke-linejoin: round; font-family: var(--font); letter-spacing: 0.02em; }
        .progress { margin-top: 28px; width: 100%; max-width: 360px; text-align: center; }
        .progress-track { width: 100%; height: 2px; background: var(--border); border-radius: 1px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; background: var(--orange); border-radius: 1px; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .progress-text { margin-top: 10px; font-size: 0.82rem; color: var(--text-dim); font-weight: 400; letter-spacing: 0.03em; }
        .progress-text span { color: var(--orange); font-weight: 600; }
        .reset-btn { background: none; border: none; color: var(--text-dim); font-family: var(--font); font-size: 0.78rem; cursor: pointer; margin-left: 12px; text-decoration: underline; text-underline-offset: 2px; opacity: 0; transition: opacity 0.3s ease, color 0.2s ease; pointer-events: none; }
        .reset-btn.show { opacity: 1; pointer-events: auto; }
        .reset-btn:hover { color: var(--orange); }
        .info-panel { padding: 32px 28px; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 10px; position: sticky; top: 32px; min-height: 340px; }
        .panel-default { transition: opacity 0.3s ease; }
        .panel-default p { color: #b0a8a0; line-height: 1.75; font-size: 1rem; font-weight: 400; }
        .panel-default p + p { margin-top: 14px; }
        .panel-default .cta { display: inline-block; margin-top: 20px; padding: 7px 16px; border: 1px solid #252525; border-radius: 5px; font-size: 0.82rem; color: var(--orange); font-weight: 500; letter-spacing: 0.02em; }
        .panel-content { display: none; animation: fadeUp 0.35s ease; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
        .concept-tag { font-size: 0.78rem; font-weight: 500; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.12em; margin-bottom: 8px; }
        .concept-name { font-size: 1.45rem; font-weight: 700; color: var(--orange); letter-spacing: -0.01em; margin-bottom: 18px; line-height: 1.2; }
        .concept-desc { line-height: 1.75; color: var(--text); font-size: 1rem; font-weight: 400; }
        .concept-relation { margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); font-size: 0.85rem; color: var(--text-dim); font-weight: 400; line-height: 1.6; }
        .concept-relation strong { color: var(--orange); font-weight: 600; }
        @keyframes completePulse { 0%, 100% { stroke-opacity: 0.7; } 50% { stroke-opacity: 1; filter: url(#glow); } }
        .complete .flower-circle.explored { animation: completePulse 2s ease 1; stroke-opacity: 0.8 !important; }
        @keyframes circleIn { from { opacity: 0; stroke-dashoffset: 502; } to { opacity: 1; stroke-dashoffset: 0; } }
        .flower-circle.animate-in { stroke-dasharray: 502; animation: circleIn 1s ease forwards; }
        .flower-circle.ring-0.animate-in { animation-delay: 0.2s; }
        .flower-circle.ring-1.animate-in { animation-delay: 0.5s; }
        .flower-circle.ring-2.animate-in { animation-delay: 0.8s; }
        @media (max-width: 900px) { main { grid-template-columns: 1fr; gap: 24px; } .info-panel { position: static; min-height: auto; order: 2; } .viz-section { order: 1; } header { margin-bottom: 32px; } .page { padding: 32px 16px 48px; } .svg-wrap { max-width: 480px; } }
        @media (max-width: 600px) { .page { padding: 24px 14px 40px; } header { margin-bottom: 24px; } header h1 { font-size: 1.5rem; } header .subtitle { font-size: 0.85rem; } .svg-wrap { max-width: 100%; } .info-panel { padding: 22px 18px; border-radius: 8px; } .concept-name { font-size: 1.25rem; margin-bottom: 14px; } .concept-desc { font-size: 0.925rem; } .concept-relation { font-size: 0.82rem; } .progress { margin-top: 20px; } .label-text { font-size: 21px; font-weight: 700; stroke-width: 3px; } }
        @media (max-width: 380px) { header h1 { font-size: 1.3rem; } .info-panel { padding: 18px 14px; } .concept-name { font-size: 1.1rem; } }

        /* ═══ Site Nav ═══ */
        .site-nav { display: flex; align-items: center; justify-content: space-between; padding: 12px 24px; background: rgba(10,9,8,0.95); border-bottom: 1px solid #1a1a1a; position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .site-nav .brand { font-family: 'Inter', -apple-system, sans-serif; font-size: 0.8rem; font-weight: 600; letter-spacing: 0.18em; text-transform: uppercase; color: #999; text-decoration: none; transition: color 0.2s; }
        .site-nav .brand:hover { color: var(--orange); }
        .site-nav .nav-links { display: flex; gap: 8px; }
        .site-nav .nav-links a { font-family: 'Inter', -apple-system, sans-serif; font-size: 0.9rem; font-weight: 500; color: #aaa; text-decoration: none; padding: 8px 16px; border-radius: 4px; transition: color 0.2s, background 0.2s; }
        .site-nav .nav-links a:hover { color: #ccc; background: rgba(255,255,255,0.04); }
        .site-nav .nav-links a.active { color: var(--orange); background: rgba(247,147,26,0.08); font-weight: 600; }
        @media (max-width: 600px) { .site-nav { padding: 10px 14px; } .site-nav .brand { font-size: 0.72rem; letter-spacing: 0.14em; } .site-nav .nav-links a { font-size: 0.85rem; padding: 6px 12px; } }
    </style>
</head>
<body>
    <nav class="site-nav">
        <a href="/" class="brand">Last Coin Standing</a>
        <div class="nav-links">
            <a href="/">The Money Trees</a>
            <a href="/what-bitcoin-is.html" class="active">What Bitcoin Is</a>
            <a href="/trilemma.html">The Trilemma</a>
            <a href="/about.html">About</a>
        </div>
    </nav>
    <div class="page">
        <header>
            <h1 id="pageTitle">What Bitcoin Is</h1>
            <p class="subtitle" id="pageSubtitle"></p>
        </header>
        <main>
            <div class="viz-section">
                <div class="svg-wrap" id="svgWrap">
                    <svg id="flower" viewBox="-260 -270 520 540" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="glow" x="-60%" y="-60%" width="220%" height="220%">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="5" result="blur"/>
                                <feFlood flood-color="#F7931A" flood-opacity="0.35"/>
                                <feComposite in2="blur" operator="in" result="colorblur"/>
                                <feMerge><feMergeNode in="colorblur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                        </defs>
                        <g id="circles-group"></g>
                        <g id="hit-group"></g>
                        <g class="float-label" id="floatLabel" style="opacity:0">
                            <rect rx="4" ry="4" fill="rgba(8,8,10,0.88)" x="0" y="0" width="0" height="0"></rect>
                        </g>
                    </svg>
                </div>
                <div class="progress">
                    <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
                    <p class="progress-text">
                        <span id="count">0</span> of <span id="totalCount">0</span> dimensions illuminated
                        <button class="reset-btn" id="resetBtn" onclick="resetAll()">reset</button>
                    </p>
                </div>
            </div>
            <div class="info-panel" id="panel">
                <div class="panel-default" id="panelDefault">
                    <p id="panelIntro"></p>
                    <p id="panelIntroSecondary"></p>
                    <span class="cta" id="panelCta"></span>
                </div>
                <div class="panel-content" id="panelContent">
                    <p class="concept-tag" id="conceptTag"></p>
                    <h2 class="concept-name" id="conceptName"></h2>
                    <p class="concept-desc" id="conceptDesc"></p>
                    <div class="concept-relation" id="conceptRelation"></div>
                </div>
            </div>
        </main>
    </div>
<script>
// ════════════════════════════════════════════════════════════
// GEOMETRY: Flower of Life positions (code, not content)
// ════════════════════════════════════════════════════════════
const R = 80, S3 = Math.sqrt(3);
const POS = {
    'center':        [0, 0],
    'top':           [0, -R],
    'top-right':     [R*S3/2, -R/2],
    'bottom-right':  [R*S3/2, R/2],
    'bottom':        [0, R],
    'bottom-left':   [-R*S3/2, R/2],
    'top-left':      [-R*S3/2, -R/2],
    'r2-top':        [0, -2*R],
    'upper-right-a': [2*R*S3/2, -2*R/2],
    'upper-right-b': [R*S3/2, -R-R/2],
    'right':         [R*S3, 0],
    'lower-right-a': [2*R*S3/2, 2*R/2],
    'lower-right-b': [R*S3/2, R+R/2],
    'r2-bottom':     [0, 2*R],
    'lower-left-b':  [-R*S3/2, R+R/2],
    'lower-left-a':  [-2*R*S3/2, 2*R/2],
    'left':          [-R*S3, 0],
    'upper-left-a':  [-2*R*S3/2, -2*R/2],
    'upper-left-b':  [-R*S3/2, -R-R/2]
};

// ════════════════════════════════════════════════════════════
// STATE
// ════════════════════════════════════════════════════════════
let concepts = [], meta = {}, explored = new Set(), activeId = null, hoverTimeout = null;
const NS = 'http://www.w3.org/2000/svg';
function svgEl(t, a) { const e = document.createElementNS(NS, t); for (const [k,v] of Object.entries(a)) e.setAttribute(k,v); return e; }

// ════════════════════════════════════════════════════════════
// CMS LOADER
// ════════════════════════════════════════════════════════════
async function loadData() {
    try {
        const r = await fetch('concepts.json');
        const d = await r.json();
        meta = d.meta;
        concepts = d.concepts.map(c => {
            // Ring 2 'top'/'bottom' map to r2-top/r2-bottom
            let posKey = c.position;
            if (c.ring === 2 && (posKey === 'top' || posKey === 'bottom')) posKey = 'r2-' + posKey;
            const [x, y] = POS[posKey] || [0, 0];
            return { ...c, x, y };
        });
        applyMeta();
        render();
    } catch (e) {
        console.error('Failed to load concepts.json:', e);
        document.getElementById('panelIntro').textContent = 'Error loading content. Ensure concepts.json is in the same directory as this HTML file.';
    }
}

function applyMeta() {
    document.getElementById('pageTitle').textContent = meta.title;
    document.getElementById('pageSubtitle').textContent = meta.subtitle;
    document.getElementById('panelIntro').textContent = meta.panelIntro;
    document.getElementById('panelIntroSecondary').textContent = meta.panelIntroSecondary;
    document.getElementById('panelCta').textContent = meta.panelCta;
    document.getElementById('totalCount').textContent = concepts.length;
    document.title = meta.title + ' | Last Coin Standing';
}

// ════════════════════════════════════════════════════════════
// RENDER
// ════════════════════════════════════════════════════════════
function render() {
    const cG = document.getElementById('circles-group'), hG = document.getElementById('hit-group');
    [...concepts].sort((a,b) => b.ring - a.ring).forEach(c => {
        cG.appendChild(svgEl('circle', { cx:c.x, cy:c.y, r:R, class:`flower-circle ring-${c.ring} animate-in`, 'data-id':c.id, id:`circle-${c.id}` }));
    });
    concepts.forEach(c => {
        const hit = svgEl('circle', { cx:c.x, cy:c.y, r:40, class:'hit-area', 'data-id':c.id });
        hit.addEventListener('mouseenter', () => handleHover(c.id));
        hit.addEventListener('mouseleave', () => handleLeave(c.id));
        hit.addEventListener('click', () => handleClick(c.id));
        hit.addEventListener('touchstart', e => { e.preventDefault(); handleClick(c.id); }, { passive: false });
        hG.appendChild(hit);
    });
    setTimeout(() => { document.querySelectorAll('.flower-circle').forEach(el => { el.classList.add('visible'); el.classList.remove('animate-in'); }); }, 1800);
}

// ════════════════════════════════════════════════════════════
// INTERACTION
// ════════════════════════════════════════════════════════════
function handleHover(id) {
    if (hoverTimeout) clearTimeout(hoverTimeout);
    const el = document.getElementById(`circle-${id}`);
    if (!explored.has(id) && id !== activeId) el.classList.add('hover');
    showLabel(id);
}
function handleLeave(id) {
    document.getElementById(`circle-${id}`).classList.remove('hover');
    hoverTimeout = setTimeout(() => { activeId ? showLabel(activeId) : hideLabel(); }, 80);
}
function handleClick(id) {
    explored.add(id); activeId = id;
    concepts.forEach(c => {
        const el = document.getElementById(`circle-${c.id}`);
        el.classList.remove('hover','active','explored');
        if (c.id === activeId) { el.classList.add('active'); el.parentNode.appendChild(el); }
        else if (explored.has(c.id)) el.classList.add('explored');
    });
    document.getElementById('svgWrap').classList.add('has-explored');
    showLabel(id); updatePanel(id); updateProgress();
    if (explored.size === concepts.length) setTimeout(celebrate, 400);
}
function showLabel(id) {
    const c = concepts.find(x => x.id === id), l = document.getElementById('floatLabel');
    const isMobile = window.innerWidth <= 600;
    const fontSize = isMobile ? 21 : 15;
    const lineHeight = fontSize * 1.25;
    const strokeW = isMobile ? 3 : 4;
    
    // Clear previous content
    while (l.children.length > 1) l.removeChild(l.lastChild);
    const bg = l.querySelector('rect');
    
    const words = c.label.split(' ');
    const isMultiWord = words.length >= 2;
    
    if (isMultiWord) {
        // Split into two lines
        const mid = Math.ceil(words.length / 2);
        const line1 = words.slice(0, mid).join(' ');
        const line2 = words.slice(mid).join(' ');
        
        const t1 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        t1.setAttribute('class', 'label-text');
        t1.setAttribute('x', '0');
        t1.setAttribute('y', -lineHeight / 2);
        t1.style.fontSize = fontSize + 'px';
        t1.style.strokeWidth = strokeW + 'px';
        t1.textContent = line1;
        
        const t2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        t2.setAttribute('class', 'label-text');
        t2.setAttribute('x', '0');
        t2.setAttribute('y', lineHeight / 2);
        t2.style.fontSize = fontSize + 'px';
        t2.style.strokeWidth = strokeW + 'px';
        t2.textContent = line2;
        
        // Size background rect
        const maxLen = Math.max(line1.length, line2.length) * fontSize * 0.58;
        bg.setAttribute('x', -maxLen / 2 - 6);
        bg.setAttribute('y', -lineHeight - 4);
        bg.setAttribute('width', maxLen + 12);
        bg.setAttribute('height', lineHeight * 2 + 8);
        
        l.appendChild(t1);
        l.appendChild(t2);
    } else {
        const t = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        t.setAttribute('class', 'label-text');
        t.setAttribute('x', '0');
        t.setAttribute('y', '0');
        t.style.fontSize = fontSize + 'px';
        t.style.strokeWidth = strokeW + 'px';
        t.textContent = c.label;
        
        const w = c.label.length * fontSize * 0.58;
        bg.setAttribute('x', -w / 2 - 6);
        bg.setAttribute('y', -fontSize / 2 - 4);
        bg.setAttribute('width', w + 12);
        bg.setAttribute('height', fontSize + 8);
        
        l.appendChild(t);
    }
    
    l.setAttribute('transform', `translate(${c.x},${c.y})`);
    l.style.opacity = '1';
}
function hideLabel() { document.getElementById('floatLabel').style.opacity = '0'; }

// ════════════════════════════════════════════════════════════
// PANEL
// ════════════════════════════════════════════════════════════
function updatePanel(id) {
    const c = concepts.find(x => x.id === id);
    const ct = document.getElementById('panelContent');
    ct.style.display = 'none'; void ct.offsetHeight;
    document.getElementById('conceptTag').textContent = c.tag;
    document.getElementById('conceptName').textContent = c.label;
    document.getElementById('conceptDesc').textContent = c.desc;
    const rel = document.getElementById('conceptRelation');
    if (c.relation) { rel.innerHTML = c.relation; rel.style.display = 'block'; }
    else rel.style.display = 'none';
    document.getElementById('panelDefault').style.display = 'none';
    ct.style.display = 'block';
}

// ════════════════════════════════════════════════════════════
// PROGRESS + COMPLETION + RESET
// ════════════════════════════════════════════════════════════
function updateProgress() {
    const n = explored.size;
    document.getElementById('count').textContent = n;
    document.getElementById('progressFill').style.width = `${(n/concepts.length)*100}%`;
    if (n >= 3) document.getElementById('resetBtn').classList.add('show');
}
function celebrate() {
    document.getElementById('svgWrap').classList.add('complete');
    const ct = document.getElementById('panelContent');
    ct.style.display = 'none'; void ct.offsetHeight;
    document.getElementById('conceptTag').textContent = `All ${concepts.length} Dimensions`;
    document.getElementById('conceptName').textContent = meta.completionTitle;
    document.getElementById('conceptDesc').textContent = meta.completionDesc;
    const rel = document.getElementById('conceptRelation');
    rel.innerHTML = meta.completionRelation; rel.style.display = 'block';
    ct.style.display = 'block';
}
function resetAll() {
    explored.clear(); activeId = null;
    concepts.forEach(c => { document.getElementById(`circle-${c.id}`).classList.remove('hover','active','explored'); });
    document.getElementById('svgWrap').classList.remove('has-explored','complete');
    hideLabel();
    document.getElementById('panelDefault').style.display = 'block';
    document.getElementById('panelContent').style.display = 'none';
    document.getElementById('count').textContent = '0';
    document.getElementById('progressFill').style.width = '0%';
    document.getElementById('resetBtn').classList.remove('show');
}

document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>
