<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Money Trees — Last Coin Standing</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg-dark: #0a0c0f;
  --btc-orange: #f7931a;
  --btc-orange-light: #ffa940;
  --btc-gold: #ffd700;
  --btc-bark: #5a4030;
  --fiat-gray: #6a7580;
  --fiat-gray-light: #8a9098;
  --fiat-bark: #454550;
  --text-light: #e8e0d5;
  --text-muted: #8b8680;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Cormorant Garamond', Georgia, serif;
  background: var(--bg-dark);
  color: var(--text-light);
  min-height: 100vh;
  overflow-x: hidden;
}

header {
  text-align: center;
  padding: 40px 20px 10px;
  position: sticky;
  top: 0;
  z-index: 100;
  background: linear-gradient(180deg, var(--bg-dark) 0%, rgba(10,12,15,0.95) 100%);
}
header h1 {
  font-size: 2rem;
  font-weight: 500;
  letter-spacing: 0.12em;
  color: var(--text-light);
  margin-bottom: 6px;
  text-transform: uppercase;
}
header p {
  font-size: 1rem;
  color: var(--text-muted);
  font-style: italic;
}

/* Toggle */
.toggle-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  padding: 15px;
  position: sticky;
  top: 85px;
  z-index: 100;
  background: linear-gradient(180deg, rgba(10,12,15,0.95) 0%, rgba(10,12,15,0) 100%);
}

.toggle-label {
  font-size: 1.2rem;
  cursor: pointer;
  opacity: 0.5;
  transition: opacity 0.3s;
  font-weight: 600;
}
.toggle-label.active { opacity: 1; }
.toggle-label.btc { color: var(--btc-orange); }
.toggle-label.fiat { color: var(--fiat-gray-light); }

.toggle-switch {
  width: 60px;
  height: 30px;
  background: #222;
  border-radius: 15px;
  cursor: pointer;
  position: relative;
  border: 1px solid #333;
}
.toggle-switch::after {
  content: '';
  position: absolute;
  width: 24px;
  height: 24px;
  background: var(--btc-orange);
  border-radius: 50%;
  top: 2px;
  left: 3px;
  transition: all 0.3s;
}
.fiat-active .toggle-switch::after {
  left: 31px;
  background: var(--fiat-gray-light);
}

/* Tree views */
.tree-view {
  display: none;
  padding: 20px;
  max-width: 900px;
  margin: 0 auto;
}
.tree-view.active { display: block; }

.tree-header {
  text-align: center;
  margin-bottom: 30px;
}
.tree-title {
  font-size: 2.2rem;
  font-weight: 600;
  margin-bottom: 8px;
  letter-spacing: 0.08em;
}
.tree-title.btc { color: var(--btc-orange); }
.tree-title.fiat { color: var(--fiat-gray-light); }

.tree-subtitle {
  font-size: 1.15rem;
  color: var(--text-muted);
  font-style: italic;
}

/* SVG Tree */
.tree-svg {
  width: 100%;
  max-width: 850px;
  height: auto;
  display: block;
  margin: 0 auto;
}

/* Cluster section styling */
.cluster-section {
  margin-bottom: 60px;
}

/* Loading */
#loading {
  text-align: center;
  padding: 100px 20px;
  font-size: 1.2rem;
  color: var(--text-muted);
}
#loading.hidden { display: none; }

/* TOOLTIP */
.tooltip {
  position: fixed;
  display: none;
  max-width: 420px;
  padding: 20px 24px;
  border-radius: 12px;
  font-size: 1.05rem;
  line-height: 1.65;
  pointer-events: none;
  z-index: 1000;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
}
.tooltip.btc {
  background: linear-gradient(145deg, rgba(30,25,20,0.98), rgba(20,15,10,0.98));
  border: 1px solid rgba(247,147,26,0.3);
}
.tooltip.fiat {
  background: linear-gradient(145deg, rgba(25,28,35,0.98), rgba(15,18,25,0.98));
  border: 1px solid rgba(100,120,140,0.3);
}

.tooltip-word {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 10px;
  letter-spacing: 0.03em;
}
.tooltip-word.btc { color: var(--btc-orange); }
.tooltip-word.fiat { color: var(--fiat-gray-light); }

.tooltip-desc {
  color: #d0ccc5;
  margin-bottom: 14px;
  font-size: 1.1rem;
  line-height: 1.6;
}

.tooltip-section {
  margin-top: 16px;
  padding-top: 14px;
  border-top: 1px solid rgba(255,255,255,0.1);
}
.tooltip-section-title {
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 8px;
  font-weight: 600;
}
.tooltip-section-title.btc { color: var(--btc-orange); }
.tooltip-section-title.fiat { color: var(--fiat-gray-light); }

.tooltip-insight {
  color: #c5c0b8;
  font-size: 1rem;
  line-height: 1.6;
}

.tooltip-contrast {
  color: #a8a5a0;
  font-size: 0.95rem;
  line-height: 1.55;
  font-style: italic;
}

.tooltip-synonyms {
  margin-top: 14px;
  padding-top: 12px;
  border-top: 1px solid rgba(255,255,255,0.08);
  font-size: 0.9rem;
  color: #908880;
}
.tooltip-synonyms span {
  display: inline-block;
  padding: 3px 10px;
  margin: 3px 4px 3px 0;
  border-radius: 12px;
  font-size: 0.85rem;
}
.tooltip-synonyms span.btc {
  background: rgba(247,147,26,0.15);
  color: var(--btc-orange-light);
}
.tooltip-synonyms span.fiat {
  background: rgba(100,120,140,0.2);
  color: var(--fiat-gray-light);
}

/* Footer */
footer {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-muted);
  font-size: 0.9rem;
}

/* Responsive */
@media (max-width: 768px) {
  header h1 { font-size: 1.5rem; }
  .tree-title { font-size: 1.8rem; }
  .tooltip { 
    max-width: 90vw; 
    font-size: 0.95rem;
    padding: 16px 18px;
  }
  .tooltip-word { font-size: 1.3rem; }
  .tooltip-desc { font-size: 1rem; }
}
</style>
</head>
<body>

<header>
  <h1>The Money Trees</h1>
  <p>Explore the nature of money — hover to discover</p>
</header>

<div class="toggle-container">
  <span class="toggle-label btc active">Bitcoin</span>
  <div class="toggle-switch" onclick="toggleView()"></div>
  <span class="toggle-label fiat">Fiat</span>
</div>

<div id="loading">Loading trees...</div>

<div class="tree-view active" id="btc-view">
  <div class="tree-header">
    <div class="tree-title btc">Bitcoin</div>
    <div class="tree-subtitle">Sound money · Sovereignty · Truth</div>
  </div>
  <svg class="tree-svg" id="btc-tree"></svg>
</div>

<div class="tree-view" id="fiat-view">
  <div class="tree-header">
    <div class="tree-title fiat">Fiat</div>
    <div class="tree-subtitle">Broken money · Coercion · Decay</div>
  </div>
  <svg class="tree-svg" id="fiat-tree"></svg>
</div>

<div class="tooltip" id="tooltip">
  <div class="tooltip-word" id="tip-word"></div>
  <div class="tooltip-desc" id="tip-desc"></div>
  <div class="tooltip-section" id="tip-insight-section">
    <div class="tooltip-section-title" id="tip-insight-title">Deeper Insight</div>
    <div class="tooltip-insight" id="tip-insight"></div>
  </div>
  <div class="tooltip-section" id="tip-contrast-section">
    <div class="tooltip-section-title" id="tip-contrast-title">The Contrast</div>
    <div class="tooltip-contrast" id="tip-contrast"></div>
  </div>
  <div class="tooltip-synonyms" id="tip-synonyms"></div>
</div>

<footer>lastcoinstanding.com</footer>

<script>
// Data will be loaded from data.json
let data = null;
let allLeaves = [];

// Load data
fetch('data.json')
  .then(r => r.json())
  .then(d => {
    data = d;
    document.getElementById('loading').classList.add('hidden');
    renderTree('btc-tree', data.bitcoin.clusters, 'btc');
    renderTree('fiat-tree', data.fiat.clusters, 'fiat');
  })
  .catch(e => {
    console.error('Error loading data:', e);
    document.getElementById('loading').textContent = 'Error loading data. Please refresh.';
  });

// Toggle view
function toggleView() {
  const body = document.body;
  const btcView = document.getElementById('btc-view');
  const fiatView = document.getElementById('fiat-view');
  const btcLabel = document.querySelector('.toggle-label.btc');
  const fiatLabel = document.querySelector('.toggle-label.fiat');
  
  body.classList.toggle('fiat-active');
  
  if (body.classList.contains('fiat-active')) {
    btcView.classList.remove('active');
    fiatView.classList.add('active');
    btcLabel.classList.remove('active');
    fiatLabel.classList.add('active');
  } else {
    btcView.classList.add('active');
    fiatView.classList.remove('active');
    btcLabel.classList.add('active');
    fiatLabel.classList.remove('active');
  }
}

// Measure text width
function measureTextWidth(text, fontSize) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  ctx.font = `600 ${fontSize}px 'Cormorant Garamond', Georgia, serif`;
  return ctx.measureText(text).width;
}

// Layout and render tree with branches and labels
function renderTree(svgId, clusters, type) {
  const svg = document.getElementById(svgId);
  if (!svg) return;
  svg.innerHTML = '';
  
  const isBtc = type === 'btc';
  const leafColor = isBtc ? '#f7931a' : '#6a7580';
  const leafColorAlt = isBtc ? '#e88510' : '#5a6570';
  const branchColor = isBtc ? '#5a4030' : '#454550';
  const labelColor = isBtc ? '#f7931a' : '#8a9098';
  const textColor = isBtc ? '#1a1510' : '#f0f0f0';
  
  // Calculate dimensions based on content
  const width = 800;
  const clusterSpacing = 280;
  const headerSpace = 80;
  const footerSpace = 120;
  
  // Calculate total height based on clusters
  let totalHeight = headerSpace;
  clusters.forEach(cluster => {
    const rows = Math.ceil(cluster.words.length / 3);
    const clusterHeight = Math.max(clusterSpacing, rows * 85 + 120);
    totalHeight += clusterHeight;
  });
  totalHeight += footerSpace;
  
  const height = totalHeight;
  svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
  svg.setAttribute('preserveAspectRatio', 'xMidYMin meet');
  
  const trunkX = width / 2;
  const trunkTop = headerSpace;
  const trunkBottom = height - footerSpace + 40;
  
  // Draw trunk
  const trunkWidth = 22;
  const trunk = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  trunk.setAttribute('d', `
    M${trunkX - trunkWidth} ${trunkBottom}
    Q${trunkX - trunkWidth * 0.8} ${trunkBottom - (trunkBottom - trunkTop) * 0.3} ${trunkX - trunkWidth * 0.4} ${trunkTop + 40}
    L${trunkX + trunkWidth * 0.4} ${trunkTop + 40}
    Q${trunkX + trunkWidth * 0.8} ${trunkBottom - (trunkBottom - trunkTop) * 0.3} ${trunkX + trunkWidth} ${trunkBottom}
    Z
  `);
  trunk.setAttribute('fill', branchColor);
  svg.appendChild(trunk);
  
  // Draw roots
  const rootAngles = [-35, -15, 15, 35];
  rootAngles.forEach(angle => {
    const rad = angle * Math.PI / 180;
    const root = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    const endX = trunkX + Math.sin(rad) * 60;
    const endY = trunkBottom + Math.cos(rad) * 45;
    root.setAttribute('d', `M${trunkX} ${trunkBottom} Q${trunkX + Math.sin(rad) * 30} ${trunkBottom + 20} ${endX} ${endY}`);
    root.setAttribute('stroke', branchColor);
    root.setAttribute('stroke-width', '10');
    root.setAttribute('fill', 'none');
    root.setAttribute('stroke-linecap', 'round');
    svg.appendChild(root);
  });
  
  // Process each cluster
  let currentY = headerSpace + 60;
  
  clusters.forEach((cluster, ci) => {
    const goLeft = ci % 2 === 0;
    const direction = goLeft ? -1 : 1;
    const numWords = cluster.words.length;
    const cols = Math.min(3, numWords);
    const rows = Math.ceil(numWords / cols);
    
    // Branch parameters
    const branchAngle = direction * (30 + (ci % 3) * 8);
    const branchRad = branchAngle * Math.PI / 180;
    const branchLen = 120;
    
    const branchStartX = trunkX;
    const branchStartY = currentY + 30;
    const branchEndX = trunkX + Math.sin(branchRad) * branchLen;
    const branchEndY = branchStartY - Math.abs(Math.cos(branchRad)) * branchLen * 0.2;
    
    // Draw branch
    const branch = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    const midX = (branchStartX + branchEndX) / 2;
    const midY = branchStartY - 10;
    branch.setAttribute('d', `M${branchStartX} ${branchStartY} Q${midX} ${midY} ${branchEndX} ${branchEndY}`);
    branch.setAttribute('stroke', branchColor);
    branch.setAttribute('stroke-width', '14');
    branch.setAttribute('fill', 'none');
    branch.setAttribute('stroke-linecap', 'round');
    svg.appendChild(branch);
    
    // Draw cluster label
    const labelX = branchEndX + direction * 10;
    const labelY = branchEndY - 25;
    
    // Label background
    const labelText = cluster.name;
    const labelFontSize = 18;
    const labelWidth = measureTextWidth(labelText, labelFontSize) + 24;
    const labelHeight = 30;
    
    const labelBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
    labelBg.setAttribute('x', goLeft ? labelX - labelWidth : labelX);
    labelBg.setAttribute('y', labelY - labelHeight / 2);
    labelBg.setAttribute('width', labelWidth);
    labelBg.setAttribute('height', labelHeight);
    labelBg.setAttribute('rx', '4');
    labelBg.setAttribute('fill', 'rgba(10,12,15,0.9)');
    labelBg.setAttribute('stroke', isBtc ? 'rgba(247,147,26,0.4)' : 'rgba(100,120,140,0.4)');
    labelBg.setAttribute('stroke-width', '1');
    svg.appendChild(labelBg);
    
    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    label.setAttribute('x', goLeft ? labelX - labelWidth / 2 : labelX + labelWidth / 2);
    label.setAttribute('y', labelY + 1);
    label.setAttribute('text-anchor', 'middle');
    label.setAttribute('dominant-baseline', 'middle');
    label.setAttribute('fill', labelColor);
    label.setAttribute('font-size', labelFontSize);
    label.setAttribute('font-weight', '600');
    label.setAttribute('font-family', "'Cormorant Garamond', Georgia, serif");
    label.textContent = labelText;
    svg.appendChild(label);
    
    // Calculate leaf positions
    const leafRadius = 42;
    const leafGapX = 100;
    const leafGapY = 90;
    const fontSize = 15;
    
    const clusterCenterX = branchEndX + direction * 80;
    const leafStartY = branchEndY + 50;
    
    cluster.words.forEach((word, wi) => {
      const row = Math.floor(wi / cols);
      const col = wi % cols;
      const colsInThisRow = Math.min(cols, numWords - row * cols);
      
      // Center each row
      const rowWidth = (colsInThisRow - 1) * leafGapX;
      const rowStartX = clusterCenterX - rowWidth / 2;
      
      let leafX = rowStartX + col * leafGapX;
      let leafY = leafStartY + row * leafGapY;
      
      // Slight offset for organic feel
      leafX += (wi % 2 === 0 ? -8 : 8);
      leafY += (row % 2 === 0 ? -5 : 5);
      
      // Draw twig to leaf
      const twig = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      const twigMidX = branchEndX + (leafX - branchEndX) * 0.4;
      const twigMidY = branchEndY + (leafY - branchEndY) * 0.3;
      twig.setAttribute('d', `M${branchEndX} ${branchEndY} Q${twigMidX} ${twigMidY} ${leafX} ${leafY - leafRadius * 0.7}`);
      twig.setAttribute('stroke', branchColor);
      twig.setAttribute('stroke-width', '3');
      twig.setAttribute('fill', 'none');
      twig.setAttribute('opacity', '0.6');
      svg.appendChild(twig);
      
      // Draw leaf (ellipse)
      const wordText = word.word;
      const textWidth = measureTextWidth(wordText, fontSize);
      const rx = Math.max(leafRadius, textWidth / 2 + 18);
      const ry = leafRadius * 0.65;
      
      const leafGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
      leafGroup.setAttribute('class', 'leaf');
      leafGroup.setAttribute('style', 'cursor: pointer;');
      
      // Store leaf data for tooltip
      const leafIndex = allLeaves.length;
      allLeaves.push({
        word: wordText,
        desc: word.description,
        insight: word.deeperInsight,
        contrast: word.contrast,
        synonyms: word.synonyms,
        cluster: cluster.name,
        type: type
      });
      
      leafGroup.setAttribute('onmouseenter', `showTooltip(event, ${leafIndex})`);
      leafGroup.setAttribute('onmouseleave', 'hideTooltip()');
      leafGroup.setAttribute('onmousemove', 'moveTooltip(event)');
      leafGroup.setAttribute('ontouchstart', `showTooltip(event, ${leafIndex})`);
      
      const ellipse = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
      ellipse.setAttribute('cx', leafX);
      ellipse.setAttribute('cy', leafY);
      ellipse.setAttribute('rx', rx);
      ellipse.setAttribute('ry', ry);
      ellipse.setAttribute('fill', wi % 2 === 0 ? leafColor : leafColorAlt);
      ellipse.setAttribute('style', 'transition: transform 0.2s, filter 0.2s;');
      leafGroup.appendChild(ellipse);
      
      // Leaf text
      const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      text.setAttribute('x', leafX);
      text.setAttribute('y', leafY + 1);
      text.setAttribute('text-anchor', 'middle');
      text.setAttribute('dominant-baseline', 'middle');
      text.setAttribute('fill', textColor);
      text.setAttribute('font-size', fontSize);
      text.setAttribute('font-weight', '600');
      text.setAttribute('font-family', "'Cormorant Garamond', Georgia, serif");
      text.setAttribute('pointer-events', 'none');
      text.textContent = wordText;
      leafGroup.appendChild(text);
      
      // Hover effect
      leafGroup.addEventListener('mouseenter', () => {
        ellipse.style.filter = 'brightness(1.15)';
        ellipse.style.transform = 'scale(1.05)';
        ellipse.style.transformOrigin = `${leafX}px ${leafY}px`;
      });
      leafGroup.addEventListener('mouseleave', () => {
        ellipse.style.filter = '';
        ellipse.style.transform = '';
      });
      
      svg.appendChild(leafGroup);
    });
    
    // Update Y position for next cluster
    currentY += Math.max(clusterSpacing, rows * leafGapY + 140);
  });
}

// Tooltip functions
const tooltip = document.getElementById('tooltip');

function showTooltip(e, leafIndex) {
  const leaf = allLeaves[leafIndex];
  if (!leaf) return;
  
  const isBtc = leaf.type === 'btc';
  
  // Update tooltip class
  tooltip.className = 'tooltip ' + leaf.type;
  
  // Update content
  document.getElementById('tip-word').textContent = leaf.word;
  document.getElementById('tip-word').className = 'tooltip-word ' + leaf.type;
  document.getElementById('tip-desc').textContent = leaf.desc;
  
  // Deeper insight
  const insightSection = document.getElementById('tip-insight-section');
  const insightTitle = document.getElementById('tip-insight-title');
  const insightContent = document.getElementById('tip-insight');
  if (leaf.insight) {
    insightSection.style.display = 'block';
    insightTitle.className = 'tooltip-section-title ' + leaf.type;
    insightContent.textContent = leaf.insight;
  } else {
    insightSection.style.display = 'none';
  }
  
  // Contrast
  const contrastSection = document.getElementById('tip-contrast-section');
  const contrastTitle = document.getElementById('tip-contrast-title');
  const contrastContent = document.getElementById('tip-contrast');
  if (leaf.contrast) {
    contrastSection.style.display = 'block';
    contrastTitle.className = 'tooltip-section-title ' + leaf.type;
    contrastTitle.textContent = isBtc ? 'Fiat Contrast' : 'Bitcoin Contrast';
    contrastContent.textContent = leaf.contrast;
  } else {
    contrastSection.style.display = 'none';
  }
  
  // Synonyms
  const synContainer = document.getElementById('tip-synonyms');
  if (leaf.synonyms && leaf.synonyms.length > 0) {
    synContainer.innerHTML = '<strong>Related:</strong> ' + 
      leaf.synonyms.map(s => `<span class="${leaf.type}">${s}</span>`).join('');
    synContainer.style.display = 'block';
  } else {
    synContainer.style.display = 'none';
  }
  
  tooltip.style.display = 'block';
  moveTooltip(e);
}

function moveTooltip(e) {
  const x = e.clientX || (e.touches && e.touches[0].clientX);
  const y = e.clientY || (e.touches && e.touches[0].clientY);
  
  const rect = tooltip.getBoundingClientRect();
  const viewportWidth = window.innerWidth;
  const viewportHeight = window.innerHeight;
  
  let left = x + 20;
  let top = y + 15;
  
  // Keep tooltip in viewport
  if (left + rect.width > viewportWidth - 20) {
    left = x - rect.width - 20;
  }
  if (top + rect.height > viewportHeight - 20) {
    top = y - rect.height - 15;
  }
  if (left < 10) left = 10;
  if (top < 10) top = 10;
  
  tooltip.style.left = left + 'px';
  tooltip.style.top = top + 'px';
}

function hideTooltip() {
  tooltip.style.display = 'none';
}

// Hide tooltip on scroll
window.addEventListener('scroll', hideTooltip);
</script>

</body>
</html>
