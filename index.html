<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Money Trees</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg-dark: #0a0c0f;
  --btc-orange: #f7931a;
  --btc-gold: #ffd700;
  --fiat-gray: #4a5568;
  --text-light: #e8e0d5;
  --text-muted: #8b8680;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Cormorant Garamond', Georgia, serif;
  background: var(--bg-dark);
  color: var(--text-light);
  min-height: 100vh;
  overflow-x: hidden;
}

header {
  text-align: center;
  padding: 40px 20px 20px;
}
header h1 {
  font-size: 2.5rem;
  font-weight: 400;
  letter-spacing: 0.15em;
  color: var(--text-light);
  margin-bottom: 8px;
}
header p {
  font-size: 1.1rem;
  color: var(--text-muted);
  font-style: italic;
}

/* Toggle - visible on both desktop and mobile */
.toggle-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  padding: 20px;
}

.toggle-label {
  font-size: 1.2rem;
  cursor: pointer;
  opacity: 0.5;
  transition: opacity 0.3s;
  font-weight: 500;
}
.toggle-label.active { opacity: 1; }
.toggle-label.btc { color: var(--btc-orange); }
.toggle-label.fiat { color: #9aa0a8; }

.toggle-switch {
  width: 60px;
  height: 30px;
  background: #333;
  border-radius: 15px;
  cursor: pointer;
  position: relative;
  border: 1px solid #444;
}
.toggle-switch::after {
  content: '';
  position: absolute;
  width: 26px;
  height: 26px;
  background: var(--btc-orange);
  border-radius: 50%;
  top: 2px;
  left: 2px;
  transition: all 0.3s;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}
.fiat-view .toggle-switch::after {
  left: 32px;
  background: #9aa0a8;
}

/* Tree views - only one visible at a time */
.tree-view {
  display: none;
  padding: 0 20px 40px;
  max-width: 800px;
  margin: 0 auto;
}
.tree-view.active { display: block; }

.tree-container {
  text-align: center;
}

.tree-title {
  font-size: 2rem;
  font-weight: 500;
  margin-bottom: 8px;
  letter-spacing: 0.1em;
}
.tree-title.btc { color: var(--btc-orange); }
.tree-title.fiat { color: #9aa0a8; }

.tree-subtitle {
  font-size: 1.1rem;
  color: var(--text-muted);
  font-style: italic;
  margin-bottom: 20px;
}

.tree-svg {
  width: 100%;
  max-width: 700px;
  height: auto;
  display: block;
  margin: 0 auto;
}

#loading {
  text-align: center;
  padding: 100px 20px;
  font-size: 1.2rem;
  color: var(--text-muted);
}
#loading.hidden { display: none; }

/* ENHANCED TOOLTIP STYLES */
.tooltip {
  position: fixed;
  display: none;
  max-width: 400px;
  padding: 18px 22px;
  border-radius: 12px;
  font-size: 0.95rem;
  line-height: 1.6;
  pointer-events: none;
  z-index: 1000;
  max-height: 75vh;
  overflow-y: auto;
}

.tooltip.btc-tip {
  background: linear-gradient(135deg, rgba(30,28,24,0.97), rgba(20,18,14,0.97));
  border: 1px solid rgba(247,147,26,0.4);
  box-shadow: 0 8px 32px rgba(0,0,0,0.6), 0 0 20px rgba(247,147,26,0.15);
}
.tooltip.fiat-tip {
  background: linear-gradient(135deg, rgba(20,22,28,0.97), rgba(12,14,18,0.97));
  border: 1px solid rgba(100,110,130,0.4);
  box-shadow: 0 8px 32px rgba(0,0,0,0.6);
}

.tooltip-word {
  font-size: 1.3rem;
  font-weight: 600;
  margin-bottom: 10px;
  letter-spacing: 0.03em;
}
.tooltip-word.btc { color: var(--btc-orange); }
.tooltip-word.fiat { color: #9aa0a8; }

.tooltip-desc {
  color: #d4ccc4;
  font-weight: 400;
  margin-bottom: 12px;
}

.tooltip-syn {
  padding: 10px 0;
  border-top: 1px solid rgba(255,255,255,0.1);
  font-size: 0.85rem;
  color: #888;
  font-style: italic;
}
.tooltip-syn-label {
  color: #666;
  font-style: normal;
  margin-right: 6px;
}
.tooltip-syn span { margin: 0 4px; }

.tooltip-deeper {
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid rgba(255,255,255,0.08);
}
.tooltip-deeper-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: #666;
  margin-bottom: 8px;
  display: block;
}
.tooltip-deeper-text {
  color: #b8b0a8;
  font-size: 0.88rem;
  line-height: 1.65;
}

.tooltip-contrast {
  margin-top: 14px;
  padding: 12px 14px;
  border-radius: 8px;
  position: relative;
}
.tooltip.btc-tip .tooltip-contrast {
  background: rgba(100,110,130,0.15);
  border-left: 3px solid rgba(100,110,130,0.5);
}
.tooltip.fiat-tip .tooltip-contrast {
  background: rgba(247,147,26,0.1);
  border-left: 3px solid rgba(247,147,26,0.5);
}

.tooltip-contrast-label {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.tooltip.btc-tip .tooltip-contrast-label { color: #7a8594; }
.tooltip.fiat-tip .tooltip-contrast-label { color: #c9a050; }

.tooltip-contrast-icon { font-size: 0.9rem; }

.tooltip-contrast-text {
  font-size: 0.85rem;
  line-height: 1.6;
}
.tooltip.btc-tip .tooltip-contrast-text { color: #8a9099; }
.tooltip.fiat-tip .tooltip-contrast-text { color: #c4b090; }

footer {
  text-align: center;
  padding: 30px 20px 50px;
  color: #4a4540;
  font-size: 0.85rem;
}
footer a { color: var(--btc-orange); text-decoration: none; }
footer a:hover { text-decoration: underline; }

/* Mobile adjustments */
@media (max-width: 600px) {
  header h1 { font-size: 1.8rem; }
  header p { font-size: 1rem; }
  
  .toggle-label { font-size: 1.1rem; }
  
  .tree-view { padding: 0 10px 40px; }
  .tree-title { font-size: 1.6rem; }
  
  .tooltip {
    max-width: calc(100vw - 32px);
    left: 16px !important;
    right: 16px !important;
    font-size: 0.9rem;
    padding: 16px 18px;
    max-height: 60vh;
  }
  .tooltip-word { font-size: 1.15rem; }
  .tooltip-desc { font-size: 0.9rem; }
  .tooltip-deeper-text { font-size: 0.82rem; }
  .tooltip-contrast-text { font-size: 0.82rem; }
}
</style>
</head>
<body class="btc-view">

<header>
  <h1>The Money Trees</h1>
  <p>Tap each leaf to explore the nature of money</p>
</header>

<div class="toggle-container">
  <span class="toggle-label btc active" onclick="showTree('btc')">Bitcoin</span>
  <div class="toggle-switch" onclick="toggleTree()"></div>
  <span class="toggle-label fiat" onclick="showTree('fiat')">Fiat</span>
</div>

<div id="btc-view" class="tree-view active">
  <div class="tree-container">
    <h2 class="tree-title btc" id="btc-title">Bitcoin</h2>
    <p class="tree-subtitle" id="btc-subtitle">Sound money · Sovereignty · Truth</p>
    <svg id="btc-tree" class="tree-svg"></svg>
  </div>
</div>

<div id="fiat-view" class="tree-view">
  <div class="tree-container">
    <h2 class="tree-title fiat" id="fiat-title">Fiat</h2>
    <p class="tree-subtitle" id="fiat-subtitle">Broken money · Coercion · Decay</p>
    <svg id="fiat-tree" class="tree-svg"></svg>
  </div>
</div>

<div id="loading">Loading...</div>

<div id="tooltip" class="tooltip">
  <div id="tip-word" class="tooltip-word"></div>
  <div id="tip-desc" class="tooltip-desc"></div>
  <div id="tip-syn" class="tooltip-syn"></div>
  <div id="tip-deeper" class="tooltip-deeper">
    <span class="tooltip-deeper-label">Deeper Insight</span>
    <div id="tip-deeper-text" class="tooltip-deeper-text"></div>
  </div>
  <div id="tip-contrast" class="tooltip-contrast">
    <div id="tip-contrast-label" class="tooltip-contrast-label">
      <span class="tooltip-contrast-icon">↔</span>
      <span id="tip-contrast-label-text">Fiat Contrast</span>
    </div>
    <div id="tip-contrast-text" class="tooltip-contrast-text"></div>
  </div>
</div>

<footer>
  <a href="https://lastcoinstanding.substack.com">lastcoinstanding.substack.com</a>
</footer>

<script>
let treeData = null;
let btcClusters = [];
let fiatClusters = [];
let currentView = 'btc';

async function loadData() {
  try {
    const response = await fetch('data.json');
    if (!response.ok) throw new Error('Failed to load data.json');
    
    treeData = await response.json();
    
    btcClusters = treeData.bitcoin.clusters.map(cluster => ({
      name: cluster.name,
      words: cluster.words.map(w => ({
        w: w.word,
        desc: w.description,
        syn: w.synonyms || [],
        deeper: w.deeperInsight || '',
        contrast: w.contrast || ''
      }))
    }));
    
    fiatClusters = treeData.fiat.clusters.map(cluster => ({
      name: cluster.name,
      words: cluster.words.map(w => ({
        w: w.word,
        desc: w.description,
        syn: w.synonyms || [],
        deeper: w.deeperInsight || '',
        contrast: w.contrast || ''
      }))
    }));
    
    document.getElementById('btc-title').textContent = treeData.bitcoin.title;
    document.getElementById('btc-subtitle').textContent = treeData.bitcoin.subtitle;
    document.getElementById('fiat-title').textContent = treeData.fiat.title;
    document.getElementById('fiat-subtitle').textContent = treeData.fiat.subtitle;
    
    document.getElementById('loading').classList.add('hidden');
    renderTree('btc-tree', btcClusters, 'btc');
    renderTree('fiat-tree', fiatClusters, 'fiat');
    
  } catch (error) {
    console.error('Error loading data:', error);
    document.getElementById('loading').textContent = 'Error loading data. Please refresh.';
  }
}

function showTree(view) {
  currentView = view;
  document.body.className = view + '-view';
  document.getElementById('btc-view').classList.toggle('active', view === 'btc');
  document.getElementById('fiat-view').classList.toggle('active', view === 'fiat');
  document.querySelector('.toggle-label.btc').classList.toggle('active', view === 'btc');
  document.querySelector('.toggle-label.fiat').classList.toggle('active', view === 'fiat');
  hideTooltip();
}

function toggleTree() { 
  showTree(currentView === 'btc' ? 'fiat' : 'btc'); 
}

function renderTree(svgId, clusters, type) {
  const svg = document.getElementById(svgId);
  if (!svg) return;
  svg.innerHTML = '';
  
  const isBtc = type === 'btc';
  const leafColor = isBtc ? '#f7931a' : '#6a7280';
  const leafColorLight = isBtc ? '#ffa53a' : '#8a9299';
  const branchColor = isBtc ? '#5c4a3a' : '#3a3f4a';
  const textColor = isBtc ? '#1a1510' : '#f0f0f0';
  
  // Count total words to determine tree height
  let totalWords = 0;
  clusters.forEach(c => totalWords += c.words.length);
  
  // Calculate dimensions - expand vertically for more words
  const width = 600;
  const baseHeight = 800;
  const extraHeightPerWord = 12;
  const height = Math.max(baseHeight, 600 + totalWords * extraHeightPerWord);
  
  svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
  
  const trunkX = width / 2;
  const trunkBottom = height - 40;
  const trunkTop = height - 160;
  const canopyTop = 50;
  
  // Draw trunk
  const trunk = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  trunk.setAttribute('d', `M${trunkX - 18} ${trunkBottom} Q${trunkX - 25} ${trunkTop + 60} ${trunkX - 10} ${trunkTop} L${trunkX + 10} ${trunkTop} Q${trunkX + 25} ${trunkTop + 60} ${trunkX + 18} ${trunkBottom} Z`);
  trunk.setAttribute('fill', branchColor);
  svg.appendChild(trunk);
  
  // Larger leaf radius for better readability
  const leafRadius = 38;
  const padding = 12;
  const leaves = [];
  
  // Position leaves with better distribution
  let allWords = [];
  clusters.forEach(c => c.words.forEach(word => allWords.push({ ...word, cluster: c.name })));
  
  // Create organic canopy shape
  const canopyHeight = trunkTop - canopyTop;
  const canopyWidth = width - 80;
  
  allWords.forEach((word, i) => {
    let placed = false;
    let attempts = 0;
    
    while (!placed && attempts < 300) {
      // Distribute throughout canopy area using elliptical distribution
      const t = Math.random();
      const angle = Math.random() * Math.PI * 2;
      
      // Use layers to fill canopy more evenly
      const layer = Math.floor(Math.random() * 5);
      const layerRadius = 0.3 + (layer * 0.15);
      
      const rx = (canopyWidth / 2) * layerRadius * (0.7 + Math.random() * 0.3);
      const ry = (canopyHeight / 2) * layerRadius * (0.6 + Math.random() * 0.4);
      
      const x = trunkX + Math.cos(angle) * rx;
      const centerY = canopyTop + canopyHeight * 0.45;
      const y = centerY + Math.sin(angle) * ry * 0.8 - (canopyHeight * 0.2);
      
      // Check bounds
      if (x < leafRadius + 20 || x > width - leafRadius - 20 || 
          y < canopyTop + leafRadius || y > trunkTop - leafRadius - 30) {
        attempts++;
        continue;
      }
      
      // Check overlap with existing leaves
      let overlaps = false;
      for (const leaf of leaves) {
        const dx = x - leaf.x, dy = y - leaf.y;
        if (Math.sqrt(dx * dx + dy * dy) < leafRadius * 2 + padding) { 
          overlaps = true; 
          break; 
        }
      }
      
      if (!overlaps) { 
        leaves.push({ x, y, word }); 
        placed = true; 
      }
      attempts++;
    }
    
    // Fallback grid placement if random fails
    if (!placed) {
      const cols = 6;
      const row = Math.floor(leaves.length / cols);
      const col = leaves.length % cols;
      const gridX = 70 + col * ((width - 140) / (cols - 1));
      const gridY = canopyTop + 50 + row * (leafRadius * 2 + padding);
      leaves.push({ x: gridX, y: gridY, word });
    }
  });
  
  // Draw main branches from trunk to canopy regions
  const branchPoints = [
    { x: trunkX - 120, y: trunkTop - 200 },
    { x: trunkX + 120, y: trunkTop - 200 },
    { x: trunkX - 80, y: trunkTop - 350 },
    { x: trunkX + 80, y: trunkTop - 350 },
    { x: trunkX, y: trunkTop - 450 }
  ];
  
  branchPoints.forEach(bp => {
    if (bp.y > canopyTop) {
      const mainBranch = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      const midY = trunkTop - (trunkTop - bp.y) * 0.4;
      mainBranch.setAttribute('d', `M${trunkX} ${trunkTop} Q${trunkX + (bp.x - trunkX) * 0.3} ${midY} ${bp.x} ${bp.y}`);
      mainBranch.setAttribute('stroke', branchColor);
      mainBranch.setAttribute('stroke-width', '8');
      mainBranch.setAttribute('fill', 'none');
      mainBranch.setAttribute('opacity', '0.7');
      mainBranch.setAttribute('stroke-linecap', 'round');
      svg.appendChild(mainBranch);
    }
  });
  
  // Draw smaller branches to each leaf
  leaves.forEach(leaf => {
    // Find nearest branch point
    let nearestBranch = branchPoints[0];
    let minDist = Infinity;
    branchPoints.forEach(bp => {
      const d = Math.sqrt((bp.x - leaf.x) ** 2 + (bp.y - leaf.y) ** 2);
      if (d < minDist && bp.y > leaf.y - 100) {
        minDist = d;
        nearestBranch = bp;
      }
    });
    
    const branch = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    const startX = nearestBranch.x + (leaf.x - nearestBranch.x) * 0.3;
    const startY = nearestBranch.y + (leaf.y - nearestBranch.y) * 0.3;
    const midX = startX + (leaf.x - startX) * 0.5;
    const midY = startY + (leaf.y - startY) * 0.3;
    
    branch.setAttribute('d', `M${startX} ${startY} Q${midX} ${midY} ${leaf.x} ${leaf.y + leafRadius * 0.8}`);
    branch.setAttribute('stroke', branchColor);
    branch.setAttribute('stroke-width', '2');
    branch.setAttribute('fill', 'none');
    branch.setAttribute('opacity', '0.5');
    svg.appendChild(branch);
  });
  
  // Draw leaves
  leaves.forEach(leaf => {
    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    g.style.cursor = 'pointer';
    
    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('cx', leaf.x);
    circle.setAttribute('cy', leaf.y);
    circle.setAttribute('r', leafRadius);
    circle.setAttribute('fill', leafColor);
    circle.setAttribute('opacity', '0.9');
    
    // Larger, more readable text
    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    text.setAttribute('x', leaf.x);
    text.setAttribute('y', leaf.y);
    text.setAttribute('text-anchor', 'middle');
    text.setAttribute('dominant-baseline', 'middle');
    text.setAttribute('fill', textColor);
    
    // Scale font based on word length
    let fontSize = 13;
    if (leaf.word.w.length > 12) fontSize = 10;
    else if (leaf.word.w.length > 9) fontSize = 11;
    else if (leaf.word.w.length > 6) fontSize = 12;
    
    text.setAttribute('font-size', fontSize);
    text.setAttribute('font-weight', '600');
    text.setAttribute('font-family', "'Cormorant Garamond', Georgia, serif");
    
    // Truncate very long words
    let displayText = leaf.word.w;
    if (displayText.length > 12) {
      displayText = displayText.slice(0, 10) + '…';
    }
    text.textContent = displayText;
    
    g.appendChild(circle);
    g.appendChild(text);
    
    g.addEventListener('mouseenter', (e) => {
      circle.setAttribute('fill', leafColorLight);
      circle.setAttribute('opacity', '1');
      circle.setAttribute('r', leafRadius + 3);
      showTooltip(e, leaf.word, type);
    });
    g.addEventListener('mouseleave', () => {
      circle.setAttribute('fill', leafColor);
      circle.setAttribute('opacity', '0.9');
      circle.setAttribute('r', leafRadius);
      hideTooltip();
    });
    g.addEventListener('click', (e) => {
      e.stopPropagation();
      showTooltip(e, leaf.word, type);
    });
    
    svg.appendChild(g);
  });
}

function showTooltip(e, word, type) {
  const tooltip = document.getElementById('tooltip');
  const tipWord = document.getElementById('tip-word');
  const tipDesc = document.getElementById('tip-desc');
  const tipSyn = document.getElementById('tip-syn');
  const tipDeeper = document.getElementById('tip-deeper');
  const tipDeeperText = document.getElementById('tip-deeper-text');
  const tipContrast = document.getElementById('tip-contrast');
  const tipContrastLabel = document.getElementById('tip-contrast-label-text');
  const tipContrastText = document.getElementById('tip-contrast-text');
  
  tipWord.textContent = word.w;
  tipWord.className = 'tooltip-word ' + type;
  tipDesc.textContent = word.desc;
  
  if (word.syn && word.syn.length > 0) {
    tipSyn.innerHTML = '<span class="tooltip-syn-label">Related:</span>' + word.syn.map(s => `<span>${s}</span>`).join(' · ');
    tipSyn.style.display = 'block';
  } else {
    tipSyn.style.display = 'none';
  }
  
  if (word.deeper && word.deeper.trim()) {
    tipDeeperText.textContent = word.deeper;
    tipDeeper.style.display = 'block';
  } else {
    tipDeeper.style.display = 'none';
  }
  
  if (word.contrast && word.contrast.trim()) {
    tipContrastLabel.textContent = type === 'btc' ? 'Fiat Contrast' : 'Bitcoin Contrast';
    tipContrastText.textContent = word.contrast;
    tipContrast.style.display = 'block';
  } else {
    tipContrast.style.display = 'none';
  }
  
  tooltip.className = 'tooltip ' + type + '-tip';
  tooltip.style.display = 'block';
  positionTooltip(e);
}

function positionTooltip(e) {
  const tooltip = document.getElementById('tooltip');
  const vw = window.innerWidth, vh = window.innerHeight;
  
  if (vw <= 600) {
    // Mobile: fixed at bottom
    tooltip.style.left = '16px';
    tooltip.style.right = '16px';
    tooltip.style.bottom = '20px';
    tooltip.style.top = 'auto';
    tooltip.style.width = 'auto';
  } else {
    // Desktop: follow cursor
    const rect = tooltip.getBoundingClientRect();
    let x = e.clientX + 20;
    let y = e.clientY + 20;
    
    if (x + 400 > vw - 20) x = e.clientX - 420;
    if (y + rect.height > vh - 20) y = vh - rect.height - 20;
    if (y < 20) y = 20;
    if (x < 20) x = 20;
    
    tooltip.style.left = x + 'px';
    tooltip.style.top = y + 'px';
    tooltip.style.right = 'auto';
    tooltip.style.bottom = 'auto';
    tooltip.style.width = '';
  }
}

function hideTooltip() { 
  document.getElementById('tooltip').style.display = 'none'; 
}

// Hide tooltip when clicking elsewhere
document.addEventListener('click', (e) => {
  if (!e.target.closest('g')) {
    hideTooltip();
  }
});

// Re-render on resize
let resizeTimeout;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(() => {
    if (treeData) {
      renderTree('btc-tree', btcClusters, 'btc');
      renderTree('fiat-tree', fiatClusters, 'fiat');
    }
  }, 250);
});

document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>
