<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Money Trees</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg-dark: #0a0c0f;
  --btc-orange: #f7931a;
  --btc-gold: #ffd700;
  --fiat-gray: #4a5568;
  --text-light: #e8e0d5;
  --text-muted: #8b8680;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Cormorant Garamond', Georgia, serif;
  background: var(--bg-dark);
  color: var(--text-light);
  min-height: 100vh;
  overflow-x: hidden;
}

header {
  text-align: center;
  padding: 40px 20px 20px;
}
header h1 {
  font-size: 2.5rem;
  font-weight: 400;
  letter-spacing: 0.15em;
  color: var(--text-light);
  margin-bottom: 8px;
}
header p {
  font-size: 1.1rem;
  color: var(--text-muted);
  font-style: italic;
}

.arena {
  display: flex;
  justify-content: center;
  gap: 40px;
  padding: 20px;
  max-width: 1400px;
  margin: 0 auto;
}

.tree-container {
  flex: 1;
  max-width: 600px;
  text-align: center;
}

.tree-title {
  font-size: 1.6rem;
  font-weight: 500;
  margin-bottom: 10px;
  letter-spacing: 0.1em;
}
.tree-title.btc { color: var(--btc-orange); }
.tree-title.fiat { color: #9aa0a8; }

.tree-subtitle {
  font-size: 0.95rem;
  color: var(--text-muted);
  font-style: italic;
  margin-bottom: 20px;
}

.tree-svg {
  width: 100%;
  height: auto;
  display: block;
}

.toggle-container {
  display: none;
  justify-content: center;
  align-items: center;
  gap: 15px;
  padding: 20px;
}

.toggle-label {
  font-size: 1.1rem;
  cursor: pointer;
  opacity: 0.5;
  transition: opacity 0.3s;
}
.toggle-label.active { opacity: 1; }
.toggle-label.btc { color: var(--btc-orange); }
.toggle-label.fiat { color: #9aa0a8; }

.toggle-switch {
  width: 50px;
  height: 26px;
  background: #333;
  border-radius: 13px;
  cursor: pointer;
  position: relative;
}
.toggle-switch::after {
  content: '';
  position: absolute;
  width: 22px;
  height: 22px;
  background: var(--btc-orange);
  border-radius: 50%;
  top: 2px;
  left: 2px;
  transition: all 0.3s;
}
.fiat-view .toggle-switch::after {
  left: 26px;
  background: #9aa0a8;
}

.tree-view { display: block; }

#loading {
  text-align: center;
  padding: 100px 20px;
  font-size: 1.2rem;
  color: var(--text-muted);
}
#loading.hidden { display: none; }

/* ENHANCED TOOLTIP STYLES */
.tooltip {
  position: fixed;
  display: none;
  max-width: 420px;
  padding: 20px 24px;
  border-radius: 12px;
  font-size: 0.95rem;
  line-height: 1.6;
  pointer-events: none;
  z-index: 1000;
  max-height: 80vh;
  overflow-y: auto;
}

.tooltip.btc-tip {
  background: linear-gradient(135deg, rgba(30,28,24,0.97), rgba(20,18,14,0.97));
  border: 1px solid rgba(247,147,26,0.4);
  box-shadow: 0 8px 32px rgba(0,0,0,0.6), 0 0 20px rgba(247,147,26,0.15);
}
.tooltip.fiat-tip {
  background: linear-gradient(135deg, rgba(20,22,28,0.97), rgba(12,14,18,0.97));
  border: 1px solid rgba(100,110,130,0.4);
  box-shadow: 0 8px 32px rgba(0,0,0,0.6);
}

.tooltip-word {
  font-size: 1.3rem;
  font-weight: 600;
  margin-bottom: 10px;
  letter-spacing: 0.03em;
}
.tooltip-word.btc { color: var(--btc-orange); }
.tooltip-word.fiat { color: #9aa0a8; }

.tooltip-desc {
  color: #d4ccc4;
  font-weight: 400;
  margin-bottom: 12px;
}

.tooltip-syn {
  padding: 10px 0;
  border-top: 1px solid rgba(255,255,255,0.1);
  font-size: 0.85rem;
  color: #888;
  font-style: italic;
}
.tooltip-syn-label {
  color: #666;
  font-style: normal;
  margin-right: 6px;
}
.tooltip-syn span { margin: 0 4px; }

.tooltip-deeper {
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid rgba(255,255,255,0.08);
}
.tooltip-deeper-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: #666;
  margin-bottom: 8px;
  display: block;
}
.tooltip-deeper-text {
  color: #b8b0a8;
  font-size: 0.9rem;
  line-height: 1.65;
}

.tooltip-contrast {
  margin-top: 16px;
  padding: 14px 16px;
  border-radius: 8px;
  position: relative;
}
.tooltip.btc-tip .tooltip-contrast {
  background: rgba(100,110,130,0.15);
  border-left: 3px solid rgba(100,110,130,0.5);
}
.tooltip.fiat-tip .tooltip-contrast {
  background: rgba(247,147,26,0.1);
  border-left: 3px solid rgba(247,147,26,0.5);
}

.tooltip-contrast-label {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.tooltip.btc-tip .tooltip-contrast-label { color: #7a8594; }
.tooltip.fiat-tip .tooltip-contrast-label { color: #c9a050; }

.tooltip-contrast-icon { font-size: 0.9rem; }

.tooltip-contrast-text {
  font-size: 0.88rem;
  line-height: 1.6;
}
.tooltip.btc-tip .tooltip-contrast-text { color: #8a9099; }
.tooltip.fiat-tip .tooltip-contrast-text { color: #c4b090; }

footer {
  text-align: center;
  padding: 30px 20px 50px;
  color: #4a4540;
  font-size: 0.85rem;
}
footer a { color: var(--btc-orange); text-decoration: none; }
footer a:hover { text-decoration: underline; }

@media (max-width: 900px) {
  .arena { display: none; }
  .toggle-container { display: flex; }
  
  .tree-view {
    display: none;
    padding: 0 10px 40px;
  }
  .tree-view.active { display: block; }
  
  .tree-container { max-width: 100%; }
  
  header h1 { font-size: 1.8rem; }
  header p { font-size: 1rem; }
  
  .tooltip {
    max-width: calc(100vw - 32px);
    left: 16px !important;
    right: 16px !important;
    font-size: 0.9rem;
    padding: 16px 18px;
    max-height: 70vh;
  }
  .tooltip-word { font-size: 1.2rem; }
  .tooltip-desc { font-size: 0.95rem; }
  .tooltip-deeper-text { font-size: 0.85rem; }
  .tooltip-contrast-text { font-size: 0.85rem; }
}
</style>
</head>
<body>

<header>
  <h1>The Money Trees</h1>
  <p>Hover over each leaf to explore the nature of money</p>
</header>

<div class="arena">
  <div class="tree-container">
    <h2 class="tree-title btc" id="btc-title">Bitcoin</h2>
    <p class="tree-subtitle" id="btc-subtitle">Sound money · Sovereignty · Truth</p>
    <svg id="btc-tree" class="tree-svg" viewBox="0 0 560 700"></svg>
  </div>
  <div class="tree-container">
    <h2 class="tree-title fiat" id="fiat-title">Fiat</h2>
    <p class="tree-subtitle" id="fiat-subtitle">Broken money · Coercion · Decay</p>
    <svg id="fiat-tree" class="tree-svg" viewBox="0 0 560 700"></svg>
  </div>
</div>

<div class="toggle-container">
  <span class="toggle-label btc active" onclick="showTree('btc')">Bitcoin</span>
  <div class="toggle-switch" onclick="toggleTree()"></div>
  <span class="toggle-label fiat" onclick="showTree('fiat')">Fiat</span>
</div>

<div id="btc-view" class="tree-view active">
  <div class="tree-container">
    <h2 class="tree-title btc">Bitcoin</h2>
    <p class="tree-subtitle">Sound money · Sovereignty · Truth</p>
    <svg id="btc-tree-mobile" class="tree-svg"></svg>
  </div>
</div>

<div id="fiat-view" class="tree-view">
  <div class="tree-container">
    <h2 class="tree-title fiat">Fiat</h2>
    <p class="tree-subtitle">Broken money · Coercion · Decay</p>
    <svg id="fiat-tree-mobile" class="tree-svg"></svg>
  </div>
</div>

<div id="loading">Loading...</div>

<div id="tooltip" class="tooltip">
  <div id="tip-word" class="tooltip-word"></div>
  <div id="tip-desc" class="tooltip-desc"></div>
  <div id="tip-syn" class="tooltip-syn"></div>
  <div id="tip-deeper" class="tooltip-deeper">
    <span class="tooltip-deeper-label">Deeper Insight</span>
    <div id="tip-deeper-text" class="tooltip-deeper-text"></div>
  </div>
  <div id="tip-contrast" class="tooltip-contrast">
    <div id="tip-contrast-label" class="tooltip-contrast-label">
      <span class="tooltip-contrast-icon">↔</span>
      <span id="tip-contrast-label-text">Fiat Contrast</span>
    </div>
    <div id="tip-contrast-text" class="tooltip-contrast-text"></div>
  </div>
</div>

<footer>
  <a href="https://lastcoinstanding.substack.com">lastcoinstanding.substack.com</a>
</footer>

<script>
let treeData = null;
let btcClusters = [];
let fiatClusters = [];
let currentView = 'btc';

async function loadData() {
  try {
    const response = await fetch('data.json');
    if (!response.ok) throw new Error('Failed to load data.json');
    
    treeData = await response.json();
    
    btcClusters = treeData.bitcoin.clusters.map(cluster => ({
      name: cluster.name,
      words: cluster.words.map(w => ({
        w: w.word,
        desc: w.description,
        syn: w.synonyms || [],
        deeper: w.deeperInsight || '',
        contrast: w.contrast || ''
      }))
    }));
    
    fiatClusters = treeData.fiat.clusters.map(cluster => ({
      name: cluster.name,
      words: cluster.words.map(w => ({
        w: w.word,
        desc: w.description,
        syn: w.synonyms || [],
        deeper: w.deeperInsight || '',
        contrast: w.contrast || ''
      }))
    }));
    
    document.getElementById('btc-title').textContent = treeData.bitcoin.title;
    document.getElementById('btc-subtitle').textContent = treeData.bitcoin.subtitle;
    document.getElementById('fiat-title').textContent = treeData.fiat.title;
    document.getElementById('fiat-subtitle').textContent = treeData.fiat.subtitle;
    
    document.getElementById('loading').classList.add('hidden');
    initTrees();
    
  } catch (error) {
    console.error('Error loading data:', error);
    document.getElementById('loading').textContent = 'Error loading data. Please refresh.';
  }
}

function isMobile() { return window.innerWidth <= 900; }

function showTree(view) {
  currentView = view;
  document.body.className = view + '-view';
  document.getElementById('btc-view').classList.toggle('active', view === 'btc');
  document.getElementById('fiat-view').classList.toggle('active', view === 'fiat');
  document.querySelector('.toggle-label.btc').classList.toggle('active', view === 'btc');
  document.querySelector('.toggle-label.fiat').classList.toggle('active', view === 'fiat');
  hideTooltip();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function toggleTree() { showTree(currentView === 'btc' ? 'fiat' : 'btc'); }

function initTrees() {
  if (isMobile()) {
    renderTree('btc-tree-mobile', btcClusters, 'btc');
    renderTree('fiat-tree-mobile', fiatClusters, 'fiat');
  } else {
    renderTree('btc-tree', btcClusters, 'btc');
    renderTree('fiat-tree', fiatClusters, 'fiat');
  }
}

function renderTree(svgId, clusters, type) {
  const svg = document.getElementById(svgId);
  if (!svg) return;
  svg.innerHTML = '';
  
  const isBtc = type === 'btc';
  const leafColor = isBtc ? '#f7931a' : '#6a7280';
  const leafColorLight = isBtc ? '#ffa53a' : '#8a9299';
  const branchColor = isBtc ? '#5c4a3a' : '#3a3f4a';
  const textColor = isBtc ? '#1a1510' : '#f0f0f0';
  
  let allWords = [];
  clusters.forEach(c => c.words.forEach(word => allWords.push({ ...word, cluster: c.name })));
  
  const width = 560, height = 700;
  const trunkX = width / 2;
  const trunkBottom = height - 30, trunkTop = height - 180;
  
  const trunk = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  trunk.setAttribute('d', `M${trunkX - 15} ${trunkBottom} Q${trunkX - 20} ${trunkTop + 50} ${trunkX - 8} ${trunkTop} L${trunkX + 8} ${trunkTop} Q${trunkX + 20} ${trunkTop + 50} ${trunkX + 15} ${trunkBottom} Z`);
  trunk.setAttribute('fill', branchColor);
  svg.appendChild(trunk);
  
  const leaves = [];
  const leafRadius = 32, padding = 8;
  
  allWords.forEach((word, i) => {
    let placed = false, attempts = 0;
    while (!placed && attempts < 200) {
      const angle = Math.random() * Math.PI * 2;
      const maxRadius = 220 + Math.random() * 40;
      const r = Math.random() * maxRadius;
      const x = trunkX + Math.cos(angle) * r * 0.95;
      const y = trunkTop - 80 - Math.abs(Math.sin(angle)) * r * 0.7 - Math.random() * 100;
      
      if (x < leafRadius + 10 || x > width - leafRadius - 10 || y < leafRadius + 10 || y > trunkTop - 20) {
        attempts++; continue;
      }
      
      let overlaps = false;
      for (const leaf of leaves) {
        const dx = x - leaf.x, dy = y - leaf.y;
        if (Math.sqrt(dx * dx + dy * dy) < leafRadius * 2 + padding) { overlaps = true; break; }
      }
      
      if (!overlaps) { leaves.push({ x, y, word }); placed = true; }
      attempts++;
    }
    
    if (!placed) {
      const row = Math.floor(i / 6), col = i % 6;
      leaves.push({ x: 60 + col * 80 + (row % 2) * 40, y: 60 + row * 75, word });
    }
  });
  
  leaves.forEach(leaf => {
    const branch = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    const startX = trunkX + (leaf.x - trunkX) * 0.1;
    const midX = trunkX + (leaf.x - trunkX) * 0.5;
    const midY = trunkTop - (trunkTop - leaf.y) * 0.4;
    branch.setAttribute('d', `M${startX} ${trunkTop} Q${midX} ${midY} ${leaf.x} ${leaf.y + leafRadius}`);
    branch.setAttribute('stroke', branchColor);
    branch.setAttribute('stroke-width', '3');
    branch.setAttribute('fill', 'none');
    branch.setAttribute('opacity', '0.6');
    svg.appendChild(branch);
  });
  
  leaves.forEach(leaf => {
    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    g.style.cursor = 'pointer';
    
    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('cx', leaf.x);
    circle.setAttribute('cy', leaf.y);
    circle.setAttribute('r', leafRadius);
    circle.setAttribute('fill', leafColor);
    circle.setAttribute('opacity', '0.9');
    
    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    text.setAttribute('x', leaf.x);
    text.setAttribute('y', leaf.y);
    text.setAttribute('text-anchor', 'middle');
    text.setAttribute('dominant-baseline', 'middle');
    text.setAttribute('fill', textColor);
    text.setAttribute('font-size', leaf.word.w.length > 10 ? '9' : '11');
    text.setAttribute('font-weight', '600');
    text.setAttribute('font-family', "'Cormorant Garamond', Georgia, serif");
    text.textContent = leaf.word.w.length > 14 ? leaf.word.w.slice(0, 12) + '…' : leaf.word.w;
    
    g.appendChild(circle);
    g.appendChild(text);
    
    g.addEventListener('mouseenter', (e) => {
      circle.setAttribute('fill', leafColorLight);
      circle.setAttribute('opacity', '1');
      showTooltip(e, leaf.word, type);
    });
    g.addEventListener('mouseleave', () => {
      circle.setAttribute('fill', leafColor);
      circle.setAttribute('opacity', '0.9');
      hideTooltip();
    });
    g.addEventListener('click', (e) => showTooltip(e, leaf.word, type));
    
    svg.appendChild(g);
  });
}

function showTooltip(e, word, type) {
  const tooltip = document.getElementById('tooltip');
  const tipWord = document.getElementById('tip-word');
  const tipDesc = document.getElementById('tip-desc');
  const tipSyn = document.getElementById('tip-syn');
  const tipDeeper = document.getElementById('tip-deeper');
  const tipDeeperText = document.getElementById('tip-deeper-text');
  const tipContrast = document.getElementById('tip-contrast');
  const tipContrastLabel = document.getElementById('tip-contrast-label-text');
  const tipContrastText = document.getElementById('tip-contrast-text');
  
  tipWord.textContent = word.w;
  tipWord.className = 'tooltip-word ' + type;
  tipDesc.textContent = word.desc;
  
  if (word.syn && word.syn.length > 0) {
    tipSyn.innerHTML = '<span class="tooltip-syn-label">Related:</span>' + word.syn.map(s => `<span>${s}</span>`).join(' · ');
    tipSyn.style.display = 'block';
  } else {
    tipSyn.style.display = 'none';
  }
  
  if (word.deeper && word.deeper.trim()) {
    tipDeeperText.textContent = word.deeper;
    tipDeeper.style.display = 'block';
  } else {
    tipDeeper.style.display = 'none';
  }
  
  if (word.contrast && word.contrast.trim()) {
    tipContrastLabel.textContent = type === 'btc' ? 'Fiat Contrast' : 'Bitcoin Contrast';
    tipContrastText.textContent = word.contrast;
    tipContrast.style.display = 'block';
  } else {
    tipContrast.style.display = 'none';
  }
  
  tooltip.className = 'tooltip ' + type + '-tip';
  tooltip.style.display = 'block';
  positionTooltip(e);
}

function positionTooltip(e) {
  const tooltip = document.getElementById('tooltip');
  const rect = tooltip.getBoundingClientRect();
  const vw = window.innerWidth, vh = window.innerHeight;
  
  if (isMobile()) {
    tooltip.style.left = '16px';
    tooltip.style.right = '16px';
    tooltip.style.bottom = '20px';
    tooltip.style.top = 'auto';
  } else {
    let x = e.clientX + 15, y = e.clientY + 15;
    if (x + rect.width > vw - 20) x = e.clientX - rect.width - 15;
    if (y + rect.height > vh - 20) y = vh - rect.height - 20;
    if (y < 20) y = 20;
    tooltip.style.left = x + 'px';
    tooltip.style.top = y + 'px';
    tooltip.style.right = 'auto';
    tooltip.style.bottom = 'auto';
  }
}

function hideTooltip() { document.getElementById('tooltip').style.display = 'none'; }

let resizeTimeout;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(() => { if (treeData) initTrees(); }, 250);
});

document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>
