<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Money Trees CMS ‚Äî Admin</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

:root {
  --btc-orange: #f7931a;
  --btc-gold: #ffb840;
  --fiat-steel: #6a7580;
  --bg-dark: #1a1a1a;
  --bg-darker: #111;
  --bg-card: #222;
  --border: #333;
  --text: #e0e0e0;
  --text-muted: #888;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Inter', -apple-system, sans-serif;
  background: var(--bg-darker);
  color: var(--text);
  min-height: 100vh;
}

header {
  background: var(--bg-dark);
  border-bottom: 1px solid var(--border);
  padding: 16px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 12px;
  position: sticky;
  top: 0;
  z-index: 100;
}

header h1 { font-size: 1.3rem; font-weight: 600; color: var(--btc-orange); }
header h1 span { color: var(--text-muted); font-weight: 400; }

.header-actions { display: flex; gap: 12px; flex-wrap: wrap; }

.btn {
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  border: none;
  transition: all 0.2s;
}

.btn-secondary { background: var(--bg-card); color: var(--text); border: 1px solid var(--border); }
.btn-secondary:hover { background: #2a2a2a; }
.btn-success { background: #2a7d2a; color: #fff; }
.btn-success:hover { background: #3a9d3a; }

.info-box {
  background: rgba(247, 147, 26, 0.1);
  border: 1px solid rgba(247, 147, 26, 0.3);
  border-radius: 8px;
  padding: 16px 20px;
  margin: 24px;
  margin-bottom: 0;
}

.info-box h3 { color: var(--btc-orange); font-size: 0.95rem; margin-bottom: 8px; }
.info-box ol { color: var(--text-muted); font-size: 0.85rem; line-height: 1.8; margin-left: 20px; margin-top: 8px; }
.info-box a { color: var(--btc-orange); }

.editor-panel { padding: 24px; max-width: 1200px; margin: 0 auto; }
.tree-selector { display: flex; gap: 12px; margin-bottom: 24px; }

.tree-tab {
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  border: 2px solid transparent;
  background: var(--bg-card);
  color: var(--text-muted);
  transition: all 0.2s;
}

.tree-tab:hover { background: #2a2a2a; }
.tree-tab.active.btc { background: rgba(247, 147, 26, 0.15); border-color: var(--btc-orange); color: var(--btc-orange); }
.tree-tab.active.fiat { background: rgba(106, 117, 128, 0.15); border-color: var(--fiat-steel); color: var(--fiat-steel); }

.tree-settings {
  background: var(--bg-card);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  border: 1px solid var(--border);
}

.tree-settings h3 { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 12px; }
.settings-row { display: flex; gap: 16px; flex-wrap: wrap; }
.setting-field { flex: 1; min-width: 200px; }
.setting-field label { display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 6px; }
.setting-field input {
  width: 100%;
  background: var(--bg-dark);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 10px 12px;
  color: var(--text);
  font-size: 0.95rem;
}
.setting-field input:focus { outline: none; border-color: var(--btc-orange); }

.cluster-section {
  background: var(--bg-card);
  border-radius: 12px;
  margin-bottom: 20px;
  overflow: hidden;
  border: 1px solid var(--border);
}

.cluster-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  background: rgba(255,255,255,0.03);
  border-bottom: 1px solid var(--border);
  cursor: pointer;
}

.cluster-header:hover { background: rgba(255,255,255,0.05); }
.cluster-header-left { display: flex; align-items: center; gap: 12px; }

.cluster-name-input {
  background: transparent;
  border: none;
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--btc-orange);
  width: 200px;
}

.cluster-name-input:focus { outline: none; border-bottom: 2px solid var(--btc-orange); }
.fiat-view .cluster-name-input { color: var(--fiat-steel); }
.fiat-view .cluster-name-input:focus { border-bottom-color: var(--fiat-steel); }

.word-count { font-size: 0.8rem; color: var(--text-muted); background: var(--bg-dark); padding: 4px 10px; border-radius: 12px; }
.cluster-header-right { display: flex; align-items: center; gap: 8px; }

.delete-cluster {
  background: none;
  border: none;
  color: #666;
  cursor: pointer;
  padding: 6px 10px;
  font-size: 0.8rem;
  border-radius: 4px;
}

.delete-cluster:hover { background: rgba(255,0,0,0.1); color: #e55; }
.cluster-toggle { color: var(--text-muted); font-size: 1.2rem; transition: transform 0.2s; padding: 4px; }
.cluster-section.collapsed .cluster-toggle { transform: rotate(-90deg); }
.cluster-section.collapsed .cluster-content { display: none; }
.cluster-content { padding: 16px; overflow-x: auto; }

.word-table { width: 100%; border-collapse: collapse; min-width: 950px; }
.word-table th {
  text-align: left;
  padding: 10px 12px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-muted);
  border-bottom: 1px solid var(--border);
}

.word-table td { padding: 8px 12px; vertical-align: top; border-bottom: 1px solid rgba(255,255,255,0.05); }
.word-table tr:last-child td { border-bottom: none; }

.word-table input, .word-table textarea {
  width: 100%;
  background: var(--bg-dark);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 8px 10px;
  color: var(--text);
  font-family: inherit;
  font-size: 0.9rem;
  resize: vertical;
}

.word-table input:focus, .word-table textarea:focus { outline: none; border-color: var(--btc-orange); }
.fiat-view .word-table input:focus, .fiat-view .word-table textarea:focus { border-color: var(--fiat-steel); }
.word-table .word-input { font-weight: 600; }
.word-table textarea { min-height: 70px; }
.word-table .syn-input { font-size: 0.85rem; color: var(--text-muted); }

.col-word { width: 110px; min-width: 110px; }
.col-desc { width: 180px; min-width: 150px; }
.col-insight { width: 220px; min-width: 180px; }
.col-contrast { width: 220px; min-width: 180px; }
.col-syn { width: 120px; min-width: 100px; }
.col-actions { width: 40px; min-width: 40px; }

.word-table .insight-input,
.word-table .contrast-input {
  min-height: 80px;
  font-size: 0.85rem;
  line-height: 1.5;
}

.delete-word {
  background: none;
  border: none;
  color: #666;
  cursor: pointer;
  padding: 4px 8px;
  font-size: 1.1rem;
  border-radius: 4px;
}

.delete-word:hover { background: rgba(255,0,0,0.1); color: #e55; }

.add-word-btn, .add-cluster-btn {
  padding: 10px 16px;
  background: rgba(255,255,255,0.05);
  border: 1px dashed var(--border);
  border-radius: 6px;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 0.85rem;
  width: 100%;
  margin-top: 12px;
}

.add-word-btn:hover, .add-cluster-btn:hover { background: rgba(255,255,255,0.08); color: var(--text); }

.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: #2a2a2a;
  padding: 14px 20px;
  border-radius: 8px;
  border: 1px solid var(--border);
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.3s;
  z-index: 1001;
}

.toast.visible { opacity: 1; transform: translateY(0); }
.toast.success { border-color: #4a4; background: rgba(68, 170, 68, 0.15); }

.file-input-wrapper { position: relative; overflow: hidden; display: inline-block; }
.file-input-wrapper input[type=file] { position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }

.modal-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.85);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.2s;
}

.modal-overlay.visible { opacity: 1; visibility: visible; }

.modal {
  background: var(--bg-card);
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  border: 1px solid var(--border);
}

.modal-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h2 { font-size: 1.1rem; }
.modal-close { background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; }
.modal-close:hover { color: var(--text); }
.modal-body { padding: 24px; }
.modal-body p { color: var(--text-muted); font-size: 0.9rem; line-height: 1.6; margin-bottom: 16px; }
.modal-body code { background: var(--bg-dark); padding: 2px 6px; border-radius: 4px; font-size: 0.85rem; }
.modal-body input {
  width: 100%;
  background: var(--bg-dark);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 12px 14px;
  color: var(--text);
  font-size: 0.95rem;
  margin-bottom: 8px;
}
.modal-body input:focus { outline: none; border-color: var(--btc-orange); }
.modal-body .hint { font-size: 0.8rem; color: var(--text-muted); }
.modal-body .hint a { color: var(--btc-orange); }
.modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px; }

.publishing { pointer-events: none; opacity: 0.7; }

@media (max-width: 768px) {
  header { padding: 12px 16px; }
  header h1 { font-size: 1.1rem; }
  .btn { padding: 8px 14px; font-size: 0.85rem; }
  .editor-panel { padding: 16px; }
  .info-box { margin: 16px; }
  .col-syn, .col-insight, .col-contrast { display: none; }
  .word-table { min-width: unset; }
  .col-desc { width: auto; }
}

@media (max-width: 1200px) and (min-width: 769px) {
  .col-insight, .col-contrast { width: 160px; min-width: 140px; }
  .word-table .insight-input,
  .word-table .contrast-input { min-height: 100px; }
}
</style>
</head>
<body>

<header>
  <h1>Money Trees <span>CMS</span></h1>
  <div class="header-actions">
    <div class="file-input-wrapper">
      <button class="btn btn-secondary">Load data.json</button>
      <input type="file" id="file-input" accept=".json" onchange="loadFile(event)">
    </div>
    <button class="btn btn-secondary" onclick="downloadJSON()">‚¨á Download</button>
    <button class="btn btn-success" onclick="publishToGitHub()">üöÄ Publish</button>
  </div>
</header>

<div class="info-box">
  <h3>How to Update Your Site</h3>
  <ol>
    <li>Edit words, descriptions, deeper insights, contrasts, and synonyms below</li>
    <li>Click <strong>"üöÄ Publish"</strong> to push changes live</li>
    <li>First time? You'll need to enter your <a href="#" onclick="showTokenHelp(); return false;">GitHub token</a> (one-time setup)</li>
  </ol>
</div>

<div class="editor-panel">
  <div class="tree-selector">
    <div class="tree-tab btc active" onclick="switchTree('btc')">Bitcoin Tree</div>
    <div class="tree-tab fiat" onclick="switchTree('fiat')">Fiat Tree</div>
  </div>
  
  <div id="tree-settings"></div>
  <div id="editor-content"></div>
</div>

<div class="modal-overlay" id="token-modal">
  <div class="modal">
    <div class="modal-header">
      <h2>GitHub Token Setup</h2>
      <button class="modal-close" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <p>To publish directly, you need a GitHub Personal Access Token. This is stored only in your browser.</p>
      <input type="password" id="token-input" placeholder="Paste your GitHub token here">
      <p class="hint">
        <a href="https://github.com/settings/tokens/new?description=Money%20Trees%20CMS&scopes=repo" target="_blank">‚Üí Click here to create a token</a><br>
        Select <code>repo</code> scope, then copy the token.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-success" onclick="saveTokenAndPublish()">Save & Publish</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
let currentTree = 'btc';

let data = {
  "bitcoin": {
    "title": "Bitcoin",
    "subtitle": "Sound money ¬∑ Sovereignty ¬∑ Truth",
    "clusters": [
      {
        "name": "Sovereignty",
        "words": [
          { "word": "Freedom", "description": "The ability to transact without permission from any authority. Bitcoin restores financial self-determination.", "synonyms": ["Liberty", "Autonomy"] },
          { "word": "Self-custody", "description": "You hold your own keys, your own wealth. No intermediary can freeze, seize, or deny access.", "synonyms": ["Control", "Ownership"] },
          { "word": "Autonomy", "description": "Independence from institutional gatekeepers. Your money answers only to you.", "synonyms": ["Independence"] },
          { "word": "Permissionless", "description": "No application required. No approval needed. Anyone can participate in the network.", "synonyms": ["Open", "Accessible"] },
          { "word": "Sovereign", "description": "Each holder is their own bank, their own central authority over their wealth.", "synonyms": ["Self-ruling"] }
        ]
      },
      {
        "name": "Integrity",
        "words": [
          { "word": "Truth", "description": "An immutable ledger that cannot lie. Every transaction is verifiable, transparent, and permanent.", "synonyms": ["Honesty", "Veracity"] },
          { "word": "Incorruptible", "description": "No entity can alter the rules, manipulate supply, or corrupt the protocol for personal gain.", "synonyms": ["Pure", "Untainted"] },
          { "word": "Transparent", "description": "Open-source code and a public ledger. Anyone can audit, verify, and trust through verification.", "synonyms": ["Open", "Visible"] },
          { "word": "Immutable", "description": "What is written cannot be erased. The ledger is permanent and tamper-proof.", "synonyms": ["Permanent", "Fixed"] },
          { "word": "Trustless", "description": "No need to trust any party. The protocol enforces rules through mathematics, not promises.", "synonyms": ["Verifiable"] }
        ]
      },
      {
        "name": "Scarcity",
        "words": [
          { "word": "21 Million", "description": "The absolute, unalterable cap. No more can ever exist. Digital scarcity perfected.", "synonyms": ["Fixed supply", "Hard cap"] },
          { "word": "Finite", "description": "Unlike fiat which can be printed infinitely, Bitcoin has mathematical limits baked into its code.", "synonyms": ["Limited", "Bounded"] },
          { "word": "Sound", "description": "Money that cannot be debased or diluted. Its purchasing power is protected by code.", "synonyms": ["Hard", "Reliable"] },
          { "word": "Pristine", "description": "Collateral with no counterparty risk. An asset that is no one's liability.", "synonyms": ["Pure", "Clean"] },
          { "word": "Deflationary", "description": "As adoption grows against fixed supply, each unit represents more of the world's value.", "synonyms": ["Appreciating"] }
        ]
      },
      {
        "name": "Resilience",
        "words": [
          { "word": "Antifragile", "description": "Attacks make it stronger. Each challenge overcome proves and improves the network.", "synonyms": ["Robust", "Hardened"] },
          { "word": "Decentralized", "description": "No single point of failure. Thousands of nodes across the globe ensure survival.", "synonyms": ["Distributed"] },
          { "word": "Unstoppable", "description": "No government, corporation, or individual can stop a valid transaction.", "synonyms": ["Censorship-resistant"] },
          { "word": "Persistent", "description": "Running continuously since 2009. The network has never been successfully attacked or shut down.", "synonyms": ["Enduring"] }
        ]
      },
      {
        "name": "Nature",
        "words": [
          { "word": "Organic", "description": "Emerged spontaneously without central planning. Grew through voluntary adoption, not mandate.", "synonyms": ["Natural", "Emergent"] },
          { "word": "Meritocratic", "description": "No privileges, no special access. Everyone plays by the same rules enforced by code.", "synonyms": ["Fair", "Equal"] },
          { "word": "Voluntary", "description": "Adoption by choice, not coercion. People opt in because they recognize its value.", "synonyms": ["Consensual"] },
          { "word": "Elegant", "description": "Simple rules create complex, beautiful order. Satoshi's design is minimalist perfection.", "synonyms": ["Simple", "Beautiful"] }
        ]
      },
      {
        "name": "Energy",
        "words": [
          { "word": "Proof-of-Work", "description": "Real energy expenditure secures the network. Unforgeable costliness creates true value.", "synonyms": ["PoW", "Mining"] },
          { "word": "Grounded", "description": "Anchored to physical reality through energy consumption. Not abstract promises but real resources.", "synonyms": ["Rooted", "Real"] },
          { "word": "Thermodynamic", "description": "Security backed by the laws of physics. Attacking requires expending real-world energy.", "synonyms": ["Physical"] },
          { "word": "Productive", "description": "Mining incentivizes renewable energy development and utilizes stranded power.", "synonyms": ["Efficient"] }
        ]
      },
      {
        "name": "Time",
        "words": [
          { "word": "Lindy", "description": "The longer it survives, the longer it's likely to survive. Each year adds to its life expectancy.", "synonyms": ["Time-tested"] },
          { "word": "Patient", "description": "Rewards low time preference. Encourages saving over consumption, planning over impulse.", "synonyms": ["Long-term"] },
          { "word": "Generational", "description": "Wealth that can be passed down intact. A store of value for centuries, not just years.", "synonyms": ["Legacy", "Heritage"] },
          { "word": "Eternal", "description": "Designed to outlast institutions, governments, and perhaps civilizations.", "synonyms": ["Timeless"] }
        ]
      },
      {
        "name": "Virtue",
        "words": [
          { "word": "Honest", "description": "Cannot lie about supply, cannot hide transactions, cannot pretend to be what it's not.", "synonyms": ["Truthful", "Sincere"] },
          { "word": "Courageous", "description": "Challenges the most powerful institutions on Earth. A peaceful revolution in money.", "synonyms": ["Bold", "Brave"] },
          { "word": "Humble", "description": "No central authority claims credit. No face on the coin. The protocol serves, not rules.", "synonyms": ["Modest"] },
          { "word": "Hopeful", "description": "Offers a path to sound money for all humanity. A tool for human flourishing.", "synonyms": ["Optimistic"] }
        ]
      }
    ]
  },
  "fiat": {
    "title": "Fiat",
    "subtitle": "Broken money ¬∑ Coercion ¬∑ Decay",
    "clusters": [
      {
        "name": "Coercion",
        "words": [
          { "word": "Compulsory", "description": "Legal tender laws force acceptance. You have no choice but to use their money.", "synonyms": ["Mandatory", "Forced"] },
          { "word": "Permissioned", "description": "Every transaction requires approval. Banks, governments, and payment processors are gatekeepers.", "synonyms": ["Controlled"] },
          { "word": "Censored", "description": "Accounts frozen, transactions blocked, access denied. Your money is only yours if they allow it.", "synonyms": ["Blocked", "Silenced"] },
          { "word": "Surveilled", "description": "Every transaction tracked, recorded, analyzed. Financial privacy is extinct.", "synonyms": ["Monitored"] },
          { "word": "Confiscated", "description": "Bail-ins, asset freezes, civil forfeiture. They can take what they claim is yours.", "synonyms": ["Seized", "Stolen"] }
        ]
      },
      {
        "name": "Dishonesty",
        "words": [
          { "word": "Opaque", "description": "Central bank decisions made in closed rooms. The true money supply is unknowable.", "synonyms": ["Hidden", "Secret"] },
          { "word": "Manipulated", "description": "Interest rates, money supply, exchange rates‚Äîall artificially controlled.", "synonyms": ["Rigged", "Distorted"] },
          { "word": "Fabricated", "description": "Created from nothing with a keystroke. No backing, no constraint, no substance.", "synonyms": ["Invented"] },
          { "word": "Deceptive", "description": "Inflation is called 'stimulus.' Money printing is 'quantitative easing.' Lies wrapped in jargon.", "synonyms": ["Misleading"] },
          { "word": "Fraudulent", "description": "Fractional reserve banking creates money that doesn't exist. A system built on accounting fiction.", "synonyms": ["Counterfeit"] }
        ]
      },
      {
        "name": "Theft",
        "words": [
          { "word": "Inflation", "description": "The silent tax that steals purchasing power while you sleep. Your savings evaporate.", "synonyms": ["Debasement"] },
          { "word": "Cantillon", "description": "Those closest to the money printer benefit first. Everyone else pays through rising prices.", "synonyms": ["Inequality"] },
          { "word": "Seigniorage", "description": "The profit governments extract by creating money worth more than its cost to produce.", "synonyms": ["Hidden tax"] },
          { "word": "Expropriation", "description": "Bail-ins turn depositors into unwilling bank investors. Your money becomes their capital.", "synonyms": ["Seizure"] }
        ]
      },
      {
        "name": "Fragility",
        "words": [
          { "word": "Centralized", "description": "Single points of failure everywhere. One decision, one hack, one policy can collapse it all.", "synonyms": ["Concentrated"] },
          { "word": "Fragile", "description": "Requires constant intervention to prevent collapse. Held together by faith and force.", "synonyms": ["Brittle", "Weak"] },
          { "word": "Dependent", "description": "Relies on trusted third parties at every step. Trust that is regularly betrayed.", "synonyms": ["Vulnerable"] },
          { "word": "Corruptible", "description": "Human administrators can be bribed, threatened, or simply make mistakes.", "synonyms": ["Exploitable"] },
          { "word": "Unstable", "description": "Boom and bust cycles engineered by monetary policy. Volatility by design.", "synonyms": ["Chaotic"] }
        ]
      },
      {
        "name": "Decay",
        "words": [
          { "word": "Debasement", "description": "Every unit becomes worth less over time. Designed to lose value. Guaranteed to fail.", "synonyms": ["Erosion", "Dilution"] },
          { "word": "Ephemeral", "description": "Average fiat currency lifespan: 27 years. All eventually go to zero.", "synonyms": ["Temporary"] },
          { "word": "Terminal", "description": "The mathematical endpoint of compound inflation is always hyperinflation or collapse.", "synonyms": ["Dying", "Doomed"] },
          { "word": "Unsalvageable", "description": "Too much debt, too much printing. The system cannot be reformed, only replaced.", "synonyms": ["Irreparable"] }
        ]
      },
      {
        "name": "Artifice",
        "words": [
          { "word": "Contrived", "description": "Designed by committees, imposed by decree. Nothing natural about it.", "synonyms": ["Artificial"] },
          { "word": "Arbitrary", "description": "Rules change on political whims. What's allowed today may be forbidden tomorrow.", "synonyms": ["Capricious"] },
          { "word": "Abstract", "description": "Disconnected from physical reality. Numbers on screens backed by nothing but promises.", "synonyms": ["Unreal", "Virtual"] },
          { "word": "Bureaucratic", "description": "Layers of administration extract value and add friction. Paper-pushers everywhere.", "synonyms": ["Administrative"] }
        ]
      }
    ]
  }
};

// Escape HTML to prevent XSS and handle special characters
function escapeHtml(text) {
  if (!text) return '';
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function renderEditor() {
  const treeKey = currentTree === 'btc' ? 'bitcoin' : 'fiat';
  const treeData = data[treeKey];
  const container = document.getElementById('editor-content');
  const settingsContainer = document.getElementById('tree-settings');
  
  container.className = currentTree === 'fiat' ? 'fiat-view' : '';
  
  settingsContainer.innerHTML = `
    <div class="tree-settings">
      <h3>Tree Settings</h3>
      <div class="settings-row">
        <div class="setting-field">
          <label>Title</label>
          <input type="text" value="${treeData.title}" onchange="updateTreeSetting('title', this.value)">
        </div>
        <div class="setting-field">
          <label>Subtitle</label>
          <input type="text" value="${treeData.subtitle}" onchange="updateTreeSetting('subtitle', this.value)">
        </div>
      </div>
    </div>
  `;
  
  let html = '';
  
  treeData.clusters.forEach((cluster, ci) => {
    html += `
      <div class="cluster-section" id="cluster-${ci}">
        <div class="cluster-header" onclick="toggleCluster(${ci})">
          <div class="cluster-header-left">
            <input type="text" class="cluster-name-input" 
                   value="${cluster.name}" 
                   onclick="event.stopPropagation()"
                   onchange="updateClusterName(${ci}, this.value)">
            <span class="word-count">${cluster.words.length} words</span>
          </div>
          <div class="cluster-header-right">
            <button class="delete-cluster" onclick="event.stopPropagation(); deleteCluster(${ci})">Delete</button>
            <span class="cluster-toggle">‚ñº</span>
          </div>
        </div>
        <div class="cluster-content">
          <table class="word-table">
            <thead>
              <tr>
                <th class="col-word">Word</th>
                <th class="col-desc">Description</th>
                <th class="col-insight">Deeper Insight</th>
                <th class="col-contrast">Contrast</th>
                <th class="col-syn">Synonyms</th>
                <th class="col-actions"></th>
              </tr>
            </thead>
            <tbody>
              ${cluster.words.map((word, wi) => `
                <tr>
                  <td><input type="text" class="word-input" value="${escapeHtml(word.word)}" onchange="updateWord(${ci}, ${wi}, 'word', this.value)"></td>
                  <td><textarea onchange="updateWord(${ci}, ${wi}, 'description', this.value)">${escapeHtml(word.description || '')}</textarea></td>
                  <td><textarea class="insight-input" onchange="updateWord(${ci}, ${wi}, 'deeperInsight', this.value)" placeholder="Extended insight...">${escapeHtml(word.deeperInsight || '')}</textarea></td>
                  <td><textarea class="contrast-input" onchange="updateWord(${ci}, ${wi}, 'contrast', this.value)" placeholder="Contrasting perspective...">${escapeHtml(word.contrast || '')}</textarea></td>
                  <td><input type="text" class="syn-input" value="${(word.synonyms || []).join(', ')}" onchange="updateSynonyms(${ci}, ${wi}, this.value)" placeholder="comma separated"></td>
                  <td><button class="delete-word" onclick="deleteWord(${ci}, ${wi})" title="Delete">√ó</button></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          <button class="add-word-btn" onclick="addWord(${ci})">+ Add Word</button>
        </div>
      </div>
    `;
  });
  
  html += `<button class="add-cluster-btn" onclick="addCluster()">+ Add New Cluster</button>`;
  container.innerHTML = html;
}

function switchTree(tree) {
  currentTree = tree;
  document.querySelectorAll('.tree-tab').forEach(tab => tab.classList.toggle('active', tab.classList.contains(tree)));
  renderEditor();
}

function toggleCluster(ci) { document.getElementById(`cluster-${ci}`).classList.toggle('collapsed'); }

function updateTreeSetting(field, value) {
  const treeKey = currentTree === 'btc' ? 'bitcoin' : 'fiat';
  data[treeKey][field] = value;
}

function updateClusterName(ci, value) {
  const treeKey = currentTree === 'btc' ? 'bitcoin' : 'fiat';
  data[treeKey].clusters[ci].name = value;
}

function updateWord(ci, wi, field, value) {
  const treeKey = currentTree === 'btc' ? 'bitcoin' : 'fiat';
  data[treeKey].clusters[ci].words[wi][field] = value;
}

function updateSynonyms(ci, wi, value) {
  const treeKey = currentTree === 'btc' ? 'bitcoin' : 'fiat';
  data[treeKey].clusters[ci].words[wi].synonyms = value.split(',').map(s => s.trim()).filter(s => s);
}

function addWord(ci) {
  const treeKey = currentTree === 'btc' ? 'bitcoin' : 'fiat';
  data[treeKey].clusters[ci].words.push({ 
    word: "New Word", 
    description: "Description goes here.", 
    deeperInsight: "",
    contrast: "",
    synonyms: [] 
  });
  renderEditor();
}

function deleteWord(ci, wi) {
  const treeKey = currentTree === 'btc' ? 'bitcoin' : 'fiat';
  if (data[treeKey].clusters[ci].words.length > 1) {
    data[treeKey].clusters[ci].words.splice(wi, 1);
    renderEditor();
  } else {
    showToast('Cannot delete the last word');
  }
}

function addCluster() {
  const treeKey = currentTree === 'btc' ? 'bitcoin' : 'fiat';
  data[treeKey].clusters.push({ name: "New Cluster", words: [{ word: "Word", description: "Description", synonyms: [] }] });
  renderEditor();
}

function deleteCluster(ci) {
  const treeKey = currentTree === 'btc' ? 'bitcoin' : 'fiat';
  if (data[treeKey].clusters.length > 1) {
    if (confirm(`Delete "${data[treeKey].clusters[ci].name}" cluster?`)) {
      data[treeKey].clusters.splice(ci, 1);
      renderEditor();
    }
  } else {
    showToast('Cannot delete the last cluster');
  }
}

function downloadJSON() {
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'data.json';
  a.click();
  URL.revokeObjectURL(a.href);
  showToast('data.json downloaded!', 'success');
}

function loadFile(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const loaded = JSON.parse(e.target.result);
      if (!loaded.bitcoin || !loaded.fiat) throw new Error('Invalid format');
      data = loaded;
      renderEditor();
      showToast('Data loaded!', 'success');
    } catch (err) {
      showToast('Error: ' + err.message);
    }
  };
  reader.readAsText(file);
  event.target.value = '';
}

function showToast(msg, type = '') {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.className = 'toast visible ' + type;
  setTimeout(() => toast.classList.remove('visible'), 3000);
}

// GitHub Publishing
const REPO_OWNER = 'Lastcoinstanding';
const REPO_NAME = 'lastcoinstanding.com';
const FILE_PATH = 'data.json';

function getToken() {
  return localStorage.getItem('github_token');
}

function saveToken(token) {
  localStorage.setItem('github_token', token);
}

function showTokenModal() {
  document.getElementById('token-modal').classList.add('visible');
  document.getElementById('token-input').value = getToken() || '';
}

function closeModal() {
  document.getElementById('token-modal').classList.remove('visible');
}

function showTokenHelp() {
  showTokenModal();
}

function saveTokenAndPublish() {
  const token = document.getElementById('token-input').value.trim();
  if (!token) {
    showToast('Please enter a token');
    return;
  }
  saveToken(token);
  closeModal();
  publishToGitHub();
}

async function publishToGitHub() {
  const token = getToken();
  
  if (!token) {
    showTokenModal();
    return;
  }
  
  const publishBtn = document.querySelector('.btn-success');
  const originalText = publishBtn.textContent;
  publishBtn.textContent = '‚è≥ Publishing...';
  publishBtn.classList.add('publishing');
  
  try {
    // Get the current file SHA (needed for updates)
    const getResponse = await fetch(
      `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`,
      {
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      }
    );
    
    let sha = null;
    if (getResponse.ok) {
      const fileData = await getResponse.json();
      sha = fileData.sha;
    }
    
    // Prepare the content
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
    
    // Create or update the file
    const updateResponse = await fetch(
      `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`,
      {
        method: 'PUT',
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          message: 'Update Money Trees content via CMS',
          content: content,
          sha: sha
        })
      }
    );
    
    if (updateResponse.ok) {
      showToast('‚úì Published! Site will update in ~30 seconds.', 'success');
    } else {
      const error = await updateResponse.json();
      if (updateResponse.status === 401) {
        localStorage.removeItem('github_token');
        showToast('Token invalid or expired. Please re-enter.');
        showTokenModal();
      } else {
        showToast('Error: ' + (error.message || 'Failed to publish'));
      }
    }
  } catch (err) {
    showToast('Error: ' + err.message);
  } finally {
    publishBtn.textContent = originalText;
    publishBtn.classList.remove('publishing');
  }
}

async function init() {
  try {
    const res = await fetch('data.json');
    if (res.ok) {
      data = await res.json();
      showToast('Loaded data.json', 'success');
    }
  } catch (e) {}
  renderEditor();
}

init();
</script>
</body>
</html>
